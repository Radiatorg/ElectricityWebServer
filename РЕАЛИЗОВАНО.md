# Что реализовано в проекте

## Общая информация

Проект представляет собой веб-приложение для планирования электросети и подбора электротехнического оборудования в жилые помещения. Состоит из двух частей:
- **Backend**: Spring Boot приложение (Java 17)
- **Frontend**: React приложение (React 19)

---

## Backend (Spring Boot)

### Технологический стек
- Java 17
- Spring Boot 3.5.7
- Spring Data JPA (Code First подход)
- Spring Security с JWT аутентификацией
- H2 Database (для разработки) / PostgreSQL (для продакшена)
- Lombok
- Maven

### Архитектура
Проект следует принципам чистой архитектуры:
- `config/` - Конфигурационные классы
- `controller/` - REST контроллеры
- `dto/` - Data Transfer Objects (request/response)
- `exception/` - Обработка исключений
- `model/` - Entity классы (JPA)
- `repository/` - Repository интерфейсы
- `security/` - Spring Security конфигурация
- `service/` - Бизнес-логика

### Модели данных (Entity)

#### 1. User (Пользователь)
- `id` - идентификатор
- `username` - уникальное имя пользователя
- `email` - уникальный email
- `password` - пароль (зашифрован BCrypt)
- `firstName` - имя
- `lastName` - фамилия
- `roles` - множество ролей (ManyToMany)
- `createdAt`, `updatedAt` - временные метки
- `enabled` - активен ли пользователь
- `projects` - список проектов пользователя

#### 2. Role (Роль)
- `id` - идентификатор
- `name` - название роли (DESIGNER, ADMIN)

#### 3. Project (Проект)
- `id` - идентификатор
- `name` - название проекта
- `description` - описание
- `designer` - проектировщик (ManyToOne с User)
- `rooms` - список помещений (OneToMany)
- `projectAppliances` - список электроприборов проекта (OneToMany)
- `createdAt`, `updatedAt` - временные метки

#### 4. Room (Помещение)
- `id` - идентификатор
- `name` - название помещения
- `area` - площадь
- `roomType` - тип помещения (ManyToOne с RoomType)
- `project` - проект (ManyToOne с Project)
- `description` - описание

#### 5. RoomType (Тип помещения)
- `id` - идентификатор
- `name` - название типа (уникальное)
- `description` - описание

#### 6. Appliance (Электроприбор)
- `id` - идентификатор
- `name` - название
- `description` - описание
- `powerConsumption` - потребляемая мощность (Вт)
- `voltage` - напряжение (В)
- `current` - ток (А)
- `category` - категория
- `active` - активен ли прибор

#### 7. ProjectAppliance (Электроприбор проекта)
- `id` - идентификатор
- `project` - проект (ManyToOne)
- `appliance` - электроприбор (ManyToOne)
- `room` - помещение, где установлен (ManyToOne, опционально)
- `quantity` - количество
- `totalPower` - общая мощность (рассчитывается)

### Безопасность

#### JWT Аутентификация
- Реализована полная JWT аутентификация
- `JwtUtils` - утилиты для работы с JWT токенами
- `JwtAuthenticationFilter` - фильтр для проверки токенов
- `UserDetailsServiceImpl` - сервис для загрузки пользователей
- `SecurityConfig` - конфигурация безопасности

#### Роли и доступ
- **DESIGNER** - проектировщик (полный доступ к проектам, назначается при регистрации)
- **ADMIN** - администратор (управление пользователями, приборами, типами помещений)

#### CORS
- Настроен CORS для работы с фронтендом
- Разрешены все методы (GET, POST, PUT, DELETE, OPTIONS)

### API Endpoints

#### Аутентификация (`/api/auth`)
- `POST /api/auth/register` - Регистрация нового пользователя
- `POST /api/auth/login` - Вход в систему

#### Профиль пользователя (`/api/user`)
- `GET /api/user/profile` - Получить текущий профиль
- `PUT /api/user/profile` - Обновить профиль
- `DELETE /api/user/profile` - Удалить профиль

#### Проекты (`/api/designer/projects`) - требует роль DESIGNER
- `GET /api/designer/projects` - Список проектов текущего пользователя
- `GET /api/designer/projects/{id}` - Получить проект по ID
- `POST /api/designer/projects` - Создать новый проект
- `PUT /api/designer/projects/{id}` - Обновить проект
- `DELETE /api/designer/projects/{id}` - Удалить проект

#### Помещения (`/api/designer/projects/{projectId}/rooms`) - требует роль DESIGNER
- `GET /api/designer/projects/{projectId}/rooms` - Список помещений проекта
- `GET /api/designer/projects/{projectId}/rooms/{roomId}` - Получить помещение
- `POST /api/designer/projects/{projectId}/rooms` - Создать помещение
- `PUT /api/designer/projects/{projectId}/rooms/{roomId}` - Обновить помещение
- `DELETE /api/designer/projects/{projectId}/rooms/{roomId}` - Удалить помещение

#### Электроприборы (`/api/appliances`)
- `GET /api/appliances` - Каталог всех активных электроприборов
- `GET /api/appliances/{id}` - Получить электроприбор по ID

#### Электроприборы проекта (`/api/designer/projects/{projectId}/appliances`) - требует роль DESIGNER
- `GET /api/designer/projects/{projectId}/appliances` - Список электроприборов проекта
- `POST /api/designer/projects/{projectId}/appliances` - Добавить электроприбор в проект
- `PUT /api/designer/projects/{projectId}/appliances/{projectApplianceId}` - Обновить электроприбор проекта
- `DELETE /api/designer/projects/{projectId}/appliances/{projectApplianceId}` - Удалить электроприбор из проекта

#### Расчеты (`/api/designer/projects/{projectId}/calculations`) - требует роль DESIGNER
- `GET /api/designer/projects/{projectId}/calculations` - Получить расчетную ведомость проекта
  - Общая потребляемая мощность
  - Общий ток
  - Количество электроприборов
  - Расчеты по помещениям
  - Сводка по типам электроприборов

#### Спецификации (`/api/designer/projects/{projectId}/specifications`) - требует роль DESIGNER
- `GET /api/designer/projects/{projectId}/specifications` - Получить спецификацию электротехнического оборудования
  - Список оборудования по категориям
  - Рекомендации по установке
  - Расчет главного автоматического выключателя

#### Администратор (`/api/admin`) - требует роль ADMIN

**Управление пользователями:**
- `GET /api/admin/users` - Список всех пользователей
- `GET /api/admin/users/{id}` - Получить пользователя
- `POST /api/admin/users` - Создать пользователя
- `PUT /api/admin/users/{id}` - Обновить пользователя
- `DELETE /api/admin/users/{id}` - Удалить пользователя

**Управление электроприборами:**
- `POST /api/admin/appliances` - Создать электроприбор
- `PUT /api/admin/appliances/{id}` - Обновить электроприбор
- `DELETE /api/admin/appliances/{id}` - Удалить электроприбор

**Управление типами помещений:**
- `GET /api/admin/room-types` - Список типов помещений
- `POST /api/admin/room-types` - Создать тип помещения
- `PUT /api/admin/room-types/{id}` - Обновить тип помещения
- `DELETE /api/admin/room-types/{id}` - Удалить тип помещения

**Просмотр проектов:**
- `GET /api/admin/projects` - Список всех проектов
- `GET /api/admin/projects/{id}` - Получить проект

**Статистика:**
- `GET /api/admin/statistics/appliances` - Статистика использования электроприборов

### Сервисы

#### AuthService
- Регистрация пользователей
- Аутентификация (логин)
- Генерация JWT токенов

#### UserService
- Управление профилем пользователя
- Получение текущего пользователя
- Обновление и удаление профиля

#### ProjectService
- CRUD операции с проектами
- Проверка прав доступа (только владелец может изменять)

#### RoomService
- CRUD операции с помещениями
- Привязка к проекту

#### ApplianceService
- Получение каталога электроприборов
- Управление электроприборами (для админа)

#### ProjectApplianceService
- Добавление электроприборов в проект
- Расчет общей мощности
- Привязка к помещениям

#### CalculationService
- Генерация расчетной ведомости
- Расчет общей мощности проекта
- Расчет общего тока
- Группировка по помещениям
- Сводка по типам электроприборов

#### SpecificationService
- Генерация спецификации оборудования
- Группировка по категориям
- Расчет главного автоматического выключателя
- Генерация рекомендаций

#### RoomTypeService
- Управление типами помещений (для админа)

#### StatisticsService
- Статистика использования электроприборов

### Обработка исключений
- `GlobalExceptionHandler` - глобальный обработчик исключений
- `ResourceNotFoundException` - исключение для отсутствующих ресурсов
- `BadRequestException` - исключение для некорректных запросов

### Инициализация данных
- `DataInitializer` - автоматическое создание ролей при первом запуске
- Создание администратора по умолчанию (username: `admin`, password: `admin123`)

---

## Frontend (React)

### Технологический стек
- React 19
- React Router DOM 7
- Axios для HTTP запросов
- CSS3 для стилизации

### Структура проекта
```
src/
├── api/              # API клиент для работы с бэкендом
├── components/       # Переиспользуемые компоненты
├── context/          # React Context (аутентификация)
├── pages/            # Страницы приложения
│   ├── admin/       # Страницы администратора
│   └── ...          # Остальные страницы
└── App.js           # Главный компонент с роутингом
```

### Компоненты

#### Layout
- Общий макет приложения
- Навигационное меню
- Отображение информации о пользователе
- Выход из системы

#### ProtectedRoute
- Защита маршрутов
- Проверка аутентификации
- Проверка ролей пользователя

### Контекст

#### AuthContext
- Управление состоянием аутентификации
- Хранение токена и данных пользователя в localStorage
- Методы: `login`, `register`, `logout`
- Проверка ролей: `hasRole`, `isDesigner`, `isAdmin`

### API клиент (`api/api.js`)
- Настройка базового URL
- Автоматическое добавление JWT токена к запросам
- Обработка ошибок (автоматический редирект при 401)
- Методы для всех API endpoints:
  - `authAPI` - аутентификация
  - `userAPI` - профиль пользователя
  - `projectAPI` - проекты
  - `roomAPI` - помещения
  - `applianceAPI` - электроприборы
  - `projectApplianceAPI` - электроприборы проекта
  - `calculationAPI` - расчеты
  - `specificationAPI` - спецификации
  - `adminAPI` - административные функции

### Страницы

#### Публичные страницы
- **Login** (`/login`) - Страница входа
- **Register** (`/register`) - Страница регистрации

#### Страницы для всех авторизованных пользователей
- **Home** (`/`) - Главная страница
- **Profile** (`/profile`) - Профиль пользователя (просмотр, редактирование, удаление)

#### Страницы для проектировщиков (DESIGNER)

**Проекты:**
- **Projects** (`/projects`) - Список проектов пользователя
- **ProjectForm** (`/projects/new`, `/projects/:id/edit`) - Создание/редактирование проекта
- **ProjectDetail** (`/projects/:id`) - Детальная информация о проекте
  - Просмотр информации о проекте
  - Список помещений
  - Список электроприборов
  - Расчетная ведомость
  - Спецификация оборудования

**Помещения:**
- **RoomForm** (`/projects/:projectId/rooms/new`, `/projects/:projectId/rooms/:roomId/edit`) - Создание/редактирование помещения

**Электроприборы:**
- **Appliances** (`/appliances`) - Каталог электроприборов
- **ProjectApplianceForm** (`/projects/:projectId/appliances/new`, `/projects/:projectId/appliances/:projectApplianceId/edit`) - Добавление/редактирование электроприбора в проект

#### Страницы для администраторов (ADMIN)

- **Users** (`/admin/users`) - Управление пользователями
- **AdminAppliances** (`/admin/appliances`) - Управление электроприборами
- **RoomTypes** (`/admin/room-types`) - Управление типами помещений
- **AdminProjects** (`/admin/projects`) - Просмотр всех проектов
- **Statistics** (`/admin/statistics`) - Статистика использования электроприборов

### Роутинг
- Настроен React Router
- Защищенные маршруты с проверкой ролей
- Автоматический редирект неавторизованных пользователей

---

## Функциональность по ролям

### Проектировщик (DESIGNER)
✅ Регистрация (новые пользователи автоматически получают роль DESIGNER)
✅ Аутентификация (вход в систему)
✅ Создание, изменение, удаление проектов электросети
✅ Добавление, изменение, удаление жилых помещений в проекте
✅ Просмотр каталога электроприборов
✅ Добавление, изменение, удаление списка электроприборов проекта
✅ Получение расчетной ведомости проекта
✅ Получение спецификации электротехнического оборудования
✅ Обновление, удаление личного профиля

### Администратор (ADMIN)
✅ Создание, изменение, удаление пользователей
✅ Добавление, изменение, удаление электроприборов
✅ Добавление, удаление типов жилых помещений
✅ Просмотр проектов электросети
✅ Просмотр статистики используемых электроприборов

---

## База данных

### Поддерживаемые СУБД
- H2 Database (по умолчанию, для разработки)
- PostgreSQL (для продакшена)

### Автоматическая инициализация
- Создание таблиц через JPA (Code First)
- Автоматическое создание ролей при первом запуске
- Создание администратора по умолчанию

---

## Что может потребовать доработки

### Возможные улучшения:
1. **Валидация данных**
   - Проверка корректности входных данных на фронтенде
   - Более детальная валидация на бэкенде

2. **Обработка ошибок**
   - Более информативные сообщения об ошибках
   - Логирование ошибок

3. **UI/UX**
   - Улучшение дизайна интерфейса
   - Добавление индикаторов загрузки
   - Улучшение мобильной версии

4. **Функциональность**
   - Экспорт расчетной ведомости в PDF/Excel
   - Экспорт спецификации в PDF
   - Поиск и фильтрация в списках
   - Пагинация для больших списков

5. **Безопасность**
   - Валидация паролей (сложность, длина)
   - Защита от CSRF (если потребуется)
   - Rate limiting для API

6. **Тестирование**
   - Unit тесты для сервисов
   - Integration тесты для контроллеров
   - E2E тесты для фронтенда

7. **Документация**
   - Swagger/OpenAPI документация для API
   - Документация для разработчиков

8. **Производительность**
   - Кэширование часто запрашиваемых данных
   - Оптимизация запросов к БД

---

## Запуск проекта

### Backend
```bash
cd Project/electro
mvn spring-boot:run
```
Приложение будет доступно по адресу: `http://localhost:8080`
H2 Console: `http://localhost:8080/h2-console`

### Frontend
```bash
cd electro-frontend
npm install
npm start
```
Приложение будет доступно по адресу: `http://localhost:3000`

### Учетные данные по умолчанию
- **Username**: `admin`
- **Password**: `admin123`
- **Роль**: ADMIN

