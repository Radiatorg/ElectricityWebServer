 
[ИНФОРМАЦИЯ О ПРОЕКТЕ] 
Директория: D:\7semestr\Electricity\Project\electro\ 
Дата: 20.12.2025 17:32:01.48 
 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\pom.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.7</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.verchuk</groupId>
    <artifactId>electro</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>electro</name>
    <description>electro</description>
    <url/>
    <licenses>
        <license/>
    </licenses>
    <developers>
        <developer/>
    </developers>
    <scm>
        <connection/>
        <developerConnection/>
        <tag/>
        <url/>
    </scm>
    <properties>
        <java.version>17</java.version>
    </properties>
    <dependencies>
        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- Spring Boot Data JPA -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <!-- Spring Boot Security -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>

        <!-- Spring Boot Validation -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>

        <!-- PostgreSQL Driver -->
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- H2 Database (для разработки) -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- JWT -->
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-api</artifactId>
            <version>0.12.3</version>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-impl</artifactId>
            <version>0.12.3</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-jackson</artifactId>
            <version>0.12.3</version>
            <scope>runtime</scope>
        </dependency>

        <!-- Spring Boot Test -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>

        <!-- Spring Security Test -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\DATABASE_SETUP.md] 
 
# Настройка базы данных PostgreSQL (Code First)

## Code First подход

Проект использует **Code First** подход - все таблицы создаются автоматически на основе Entity классов при запуске приложения. Вам нужно создать только пустую базу данных.

## Шаги настройки

### 1. Установка PostgreSQL

Если PostgreSQL не установлен:
- **Windows**: https://www.postgresql.org/download/windows/
- **macOS**: `brew install postgresql` или https://www.postgresql.org/download/macosx/
- **Linux**: 
  ```bash
  sudo apt-get update
  sudo apt-get install postgresql postgresql-contrib
  ```

### 2. Создание пустой базы данных

**ВАЖНО**: Создайте только пустую базу данных. Таблицы создадутся автоматически!

#### Вариант 1: Через psql (командная строка)
```bash
# Подключитесь к PostgreSQL
psql -U postgres

# Создайте базу данных
CREATE DATABASE electrodb;

# Выйдите
\q
```

#### Вариант 2: Через pgAdmin (графический интерфейс)
1. Откройте pgAdmin
2. Правый клик на "Databases" → "Create" → "Database"
3. Имя: `electrodb`
4. Нажмите "Save"

#### Вариант 3: Через командную строку (одна команда)
```bash
psql -U postgres -c "CREATE DATABASE electrodb;"
```

### 3. Настройка в application.properties

Проверьте настройки в `application.properties`:

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/electrodb
spring.datasource.username=postgres
spring.datasource.password=ваш_пароль
```

**Если у вас другой пароль для пользователя postgres**, измените его в `application.properties`.

### 4. Запуск приложения

После создания пустой базы данных просто запустите приложение:

```bash
mvn spring-boot:run
```

**Что произойдет автоматически:**
- ✅ Spring Boot подключится к базе данных
- ✅ Hibernate создаст все таблицы на основе Entity классов
- ✅ Создадутся все связи между таблицами
- ✅ Инициализируются роли (DESIGNER, ADMIN) через DataInitializer
- ✅ Создастся администратор по умолчанию (username: admin, password: admin123)

### 5. Проверка

После запуска проверьте, что таблицы созданы:

```sql
psql -U postgres -d electrodb
\dt  -- список таблиц
```

Вы должны увидеть таблицы:
- users
- roles
- user_roles
- projects
- rooms
- room_types
- appliances
- project_appliances
- floor_plans
- walls
- wall_openings
- electrical_points
- electrical_symbols
- placement_rules

## Автоматическое обновление схемы

Благодаря `spring.jpa.hibernate.ddl-auto=update`:
- При добавлении новых Entity классов - создадутся новые таблицы
- При изменении существующих Entity - обновятся существующие таблицы
- **Данные сохраняются** при обновлении схемы

## Важно

- ❌ **НЕ создавайте таблицы вручную** - они создадутся автоматически
- ✅ **Создайте только пустую базу данных** `electrodb`
- ✅ При изменении Entity классов схема обновится автоматически

---

## H2 (для разработки)

Если хотите использовать H2 вместо PostgreSQL, раскомментируйте соответствующие строки в `application.properties` и закомментируйте настройки PostgreSQL.

---

## Переключение между базами данных

Можно использовать профили Spring Boot для удобного переключения:

### application-dev.properties (H2)
```properties
spring.datasource.url=jdbc:h2:file:./data/electrodb
spring.datasource.driverClassName=org.h2.Driver
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
```

### application-prod.properties (PostgreSQL)
```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/electrodb
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
```

Запуск с профилем:
```bash
mvn spring-boot:run -Dspring-boot.run.profiles=dev
# или
mvn spring-boot:run -Dspring-boot.run.profiles=prod
```

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\HELP.md] 
 
# Getting Started

### Reference Documentation

For further reference, please consider the following sections:

* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)
* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/3.5.7/maven-plugin)
* [Create an OCI image](https://docs.spring.io/spring-boot/3.5.7/maven-plugin/build-image.html)

### Maven Parent overrides

Due to Maven's design, elements are inherited from the parent POM to the project POM.
While most of the inheritance is fine, it also inherits unwanted elements like `<license>` and `<developers>` from the
parent.
To prevent this, the project POM contains empty overrides for these elements.
If you manually switch to a different parent and actually want the inheritance, you need to remove those overrides.

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\POSTGRES_SETUP.md] 
 
# Настройка PostgreSQL - Решение проблем с подключением

## Ошибка: "пароль пользователя postgres неверный"

Эта ошибка означает, что пароль в `application.properties` не совпадает с паролем пользователя `postgres` в PostgreSQL.

## Решение

### Вариант 1: Узнать/изменить пароль пользователя postgres

#### Windows (через командную строку):
```bash
# Подключитесь к PostgreSQL (может запросить пароль)
psql -U postgres

# Если не знаете пароль, попробуйте сбросить его:
# 1. Найдите файл pg_hba.conf (обычно в C:\Program Files\PostgreSQL\XX\data\)
# 2. Измените метод аутентификации для local на "trust"
# 3. Перезапустите PostgreSQL
# 4. Подключитесь без пароля и установите новый пароль:
ALTER USER postgres WITH PASSWORD 'новый_пароль';
```

#### Linux/macOS:
```bash
# Попробуйте подключиться
sudo -u postgres psql

# Или если знаете пароль
psql -U postgres

# Установить новый пароль
ALTER USER postgres WITH PASSWORD 'новый_пароль';
```

### Вариант 2: Создать нового пользователя с известным паролем

```sql
-- Подключитесь к PostgreSQL (как суперпользователь)
CREATE USER electro_user WITH PASSWORD 'electro123';
ALTER USER electro_user CREATEDB;
GRANT ALL PRIVILEGES ON DATABASE electrodb TO electro_user;
```

Затем измените в `application.properties`:
```properties
spring.datasource.username=electro_user
spring.datasource.password=electro123
```

### Вариант 3: Использовать pgAdmin (графический интерфейс)

1. Откройте pgAdmin
2. Подключитесь к серверу PostgreSQL
3. Правый клик на "Login/Group Roles" → "Create" → "Login/Group Role"
4. Укажите имя и пароль
5. Во вкладке "Privileges" дайте права на создание баз данных
6. Обновите `application.properties` с новыми данными

## Проверка подключения

Перед запуском приложения проверьте подключение:

```bash
psql -U postgres -d electrodb
# или
psql -U ваш_пользователь -d electrodb
```

Если подключение успешно, значит данные верны.

## Создание базы данных

Убедитесь, что база данных `electrodb` создана:

```sql
CREATE DATABASE electrodb;
```

## Обновление application.properties

После того как узнаете правильный пароль, обновите файл:

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/electrodb
spring.datasource.username=postgres  # или ваш_пользователь
spring.datasource.password=ваш_правильный_пароль
```

## Быстрое решение (если забыли пароль)

### Windows:
1. Остановите службу PostgreSQL
2. Найдите файл `pg_hba.conf` в папке данных PostgreSQL
3. Измените строку:
   ```
   # было:
   host    all             all             127.0.0.1/32            md5
   # станет:
   host    all             all             127.0.0.1/32            trust
   ```
4. Запустите службу PostgreSQL
5. Подключитесь без пароля: `psql -U postgres`
6. Установите новый пароль: `ALTER USER postgres WITH PASSWORD 'postgres';`
7. Верните `md5` в `pg_hba.conf` и перезапустите службу

### Linux/macOS:
```bash
sudo -u postgres psql
ALTER USER postgres WITH PASSWORD 'postgres';
\q
```



 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\README.md] 
 
# Web-приложение «Сервис для планирования электросети и подбора оборудования в жилые помещения»

## Описание проекта

Веб-приложение для планирования электросети и подбора электротехнического оборудования в жилые помещения. Разработано на Java с использованием Spring Boot.

## Технологический стек

- **Java 17**
- **Spring Boot 3.5.7**
- **Spring Data JPA** (Code First подход)
- **Spring Security** с JWT аутентификацией
- **H2 Database** (для разработки) / **PostgreSQL** (для продакшена)
- **Lombok**
- **Maven**

## Архитектура проекта

Проект следует принципам чистой архитектуры:

```
src/main/java/com/verchuk/electro/
├── config/              # Конфигурационные классы
├── controller/          # REST контроллеры
├── dto/                 # Data Transfer Objects
│   ├── request/         # DTO для запросов
│   └── response/        # DTO для ответов
├── exception/           # Обработка исключений
├── model/              # Entity классы (JPA)
├── repository/         # Repository интерфейсы
├── security/           # Spring Security конфигурация
└── service/            # Бизнес-логика
```

## Роли пользователей

### Проектировщик (DESIGNER)
- Регистрация (новые пользователи автоматически получают роль DESIGNER)
- Аутентификация
- Создание, изменение, удаление проектов электросети
- Добавление, изменение, удаление жилых помещений в проект
- Просмотр каталога электроприборов
- Добавление, изменение, удаление списка электроприборов проекта
- Получение расчетной ведомости проекта
- Получение спецификации электротехнического оборудования
- Обновление, удаление личного профиля

### Администратор (ADMIN)
- Создание, изменение, удаление пользователей
- Добавление, изменение, удаление электроприборов
- Добавление, удаление типов жилых помещений
- Просмотр проектов электросети
- Просмотр статистики используемых электроприборов

## API Endpoints

### Аутентификация
- `POST /api/auth/register` - Регистрация
- `POST /api/auth/login` - Вход

### Профиль пользователя
- `GET /api/user/profile` - Получить текущий профиль
- `PUT /api/user/profile` - Обновить профиль
- `DELETE /api/user/profile` - Удалить профиль

### Проекты (требует роль DESIGNER)
- `GET /api/designer/projects` - Список проектов
- `GET /api/designer/projects/{id}` - Получить проект
- `POST /api/designer/projects` - Создать проект
- `PUT /api/designer/projects/{id}` - Обновить проект
- `DELETE /api/designer/projects/{id}` - Удалить проект

### Помещения (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/rooms` - Список помещений
- `GET /api/designer/projects/{projectId}/rooms/{roomId}` - Получить помещение
- `POST /api/designer/projects/{projectId}/rooms` - Создать помещение
- `PUT /api/designer/projects/{projectId}/rooms/{roomId}` - Обновить помещение
- `DELETE /api/designer/projects/{projectId}/rooms/{roomId}` - Удалить помещение

### Электроприборы
- `GET /api/appliances` - Каталог электроприборов
- `GET /api/appliances/{id}` - Получить электроприбор

### Электроприборы проекта (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/appliances` - Список электроприборов проекта
- `POST /api/designer/projects/{projectId}/appliances` - Добавить электроприбор
- `PUT /api/designer/projects/{projectId}/appliances/{projectApplianceId}` - Обновить электроприбор
- `DELETE /api/designer/projects/{projectId}/appliances/{projectApplianceId}` - Удалить электроприбор

### Расчеты (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/calculations` - Получить расчетную ведомость

### Спецификации (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/specifications` - Получить спецификацию оборудования

### Администратор (требует роль ADMIN)
- `GET /api/admin/users` - Список пользователей
- `GET /api/admin/users/{id}` - Получить пользователя
- `POST /api/admin/users` - Создать пользователя
- `PUT /api/admin/users/{id}` - Обновить пользователя
- `DELETE /api/admin/users/{id}` - Удалить пользователя
- `POST /api/admin/appliances` - Создать электроприбор
- `PUT /api/admin/appliances/{id}` - Обновить электроприбор
- `DELETE /api/admin/appliances/{id}` - Удалить электроприбор
- `GET /api/admin/room-types` - Список типов помещений
- `POST /api/admin/room-types` - Создать тип помещения
- `PUT /api/admin/room-types/{id}` - Обновить тип помещения
- `DELETE /api/admin/room-types/{id}` - Удалить тип помещения
- `GET /api/admin/projects` - Список всех проектов
- `GET /api/admin/projects/{id}` - Получить проект
- `GET /api/admin/statistics/appliances` - Статистика электроприборов

## Запуск приложения

1. Убедитесь, что установлены Java 17 и Maven
2. Клонируйте репозиторий
3. Запустите приложение:
   ```bash
   mvn spring-boot:run
   ```
4. Приложение будет доступно по адресу: `http://localhost:8080`
5. H2 Console доступна по адресу: `http://localhost:8080/h2-console`

## Настройка базы данных

По умолчанию используется H2 in-memory база данных. Для использования PostgreSQL:

1. Раскомментируйте соответствующие строки в `application.properties`
2. Создайте базу данных PostgreSQL
3. Обновите настройки подключения

## JWT Аутентификация

Все защищенные endpoints требуют JWT токен в заголовке:
```
Authorization: Bearer <token>
```

Токен получается при регистрации или входе через `/api/auth/register` или `/api/auth/login`.

## Инициализация данных

При первом запуске автоматически создаются роли:
- DESIGNER
- ADMIN

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\project_code.txt] 
 
 
[ИНФОРМАЦИЯ О ПРОЕКТЕ] 
Директория: D:\7semestr\Electricity\Project\electro\ 
Дата: 20.12.2025 17:32:01.48 
 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\pom.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.7</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.verchuk</groupId>
    <artifactId>electro</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>electro</name>
    <description>electro</description>
    <url/>
    <licenses>
        <license/>
    </licenses>
    <developers>
        <developer/>
    </developers>
    <scm>
        <connection/>
        <developerConnection/>
        <tag/>
        <url/>
    </scm>
    <properties>
        <java.version>17</java.version>
    </properties>
    <dependencies>
        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- Spring Boot Data JPA -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <!-- Spring Boot Security -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>

        <!-- Spring Boot Validation -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>

        <!-- PostgreSQL Driver -->
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- H2 Database (для разработки) -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- JWT -->
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-api</artifactId>
            <version>0.12.3</version>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-impl</artifactId>
            <version>0.12.3</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-jackson</artifactId>
            <version>0.12.3</version>
            <scope>runtime</scope>
        </dependency>

        <!-- Spring Boot Test -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>

        <!-- Spring Security Test -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\DATABASE_SETUP.md] 
 
# Настройка базы данных PostgreSQL (Code First)

## Code First подход

Проект использует **Code First** подход - все таблицы создаются автоматически на основе Entity классов при запуске приложения. Вам нужно создать только пустую базу данных.

## Шаги настройки

### 1. Установка PostgreSQL

Если PostgreSQL не установлен:
- **Windows**: https://www.postgresql.org/download/windows/
- **macOS**: `brew install postgresql` или https://www.postgresql.org/download/macosx/
- **Linux**: 
  ```bash
  sudo apt-get update
  sudo apt-get install postgresql postgresql-contrib
  ```

### 2. Создание пустой базы данных

**ВАЖНО**: Создайте только пустую базу данных. Таблицы создадутся автоматически!

#### Вариант 1: Через psql (командная строка)
```bash
# Подключитесь к PostgreSQL
psql -U postgres

# Создайте базу данных
CREATE DATABASE electrodb;

# Выйдите
\q
```

#### Вариант 2: Через pgAdmin (графический интерфейс)
1. Откройте pgAdmin
2. Правый клик на "Databases" → "Create" → "Database"
3. Имя: `electrodb`
4. Нажмите "Save"

#### Вариант 3: Через командную строку (одна команда)
```bash
psql -U postgres -c "CREATE DATABASE electrodb;"
```

### 3. Настройка в application.properties

Проверьте настройки в `application.properties`:

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/electrodb
spring.datasource.username=postgres
spring.datasource.password=ваш_пароль
```

**Если у вас другой пароль для пользователя postgres**, измените его в `application.properties`.

### 4. Запуск приложения

После создания пустой базы данных просто запустите приложение:

```bash
mvn spring-boot:run
```

**Что произойдет автоматически:**
- ✅ Spring Boot подключится к базе данных
- ✅ Hibernate создаст все таблицы на основе Entity классов
- ✅ Создадутся все связи между таблицами
- ✅ Инициализируются роли (DESIGNER, ADMIN) через DataInitializer
- ✅ Создастся администратор по умолчанию (username: admin, password: admin123)

### 5. Проверка

После запуска проверьте, что таблицы созданы:

```sql
psql -U postgres -d electrodb
\dt  -- список таблиц
```

Вы должны увидеть таблицы:
- users
- roles
- user_roles
- projects
- rooms
- room_types
- appliances
- project_appliances
- floor_plans
- walls
- wall_openings
- electrical_points
- electrical_symbols
- placement_rules

## Автоматическое обновление схемы

Благодаря `spring.jpa.hibernate.ddl-auto=update`:
- При добавлении новых Entity классов - создадутся новые таблицы
- При изменении существующих Entity - обновятся существующие таблицы
- **Данные сохраняются** при обновлении схемы

## Важно

- ❌ **НЕ создавайте таблицы вручную** - они создадутся автоматически
- ✅ **Создайте только пустую базу данных** `electrodb`
- ✅ При изменении Entity классов схема обновится автоматически

---

## H2 (для разработки)

Если хотите использовать H2 вместо PostgreSQL, раскомментируйте соответствующие строки в `application.properties` и закомментируйте настройки PostgreSQL.

---

## Переключение между базами данных

Можно использовать профили Spring Boot для удобного переключения:

### application-dev.properties (H2)
```properties
spring.datasource.url=jdbc:h2:file:./data/electrodb
spring.datasource.driverClassName=org.h2.Driver
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
```

### application-prod.properties (PostgreSQL)
```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/electrodb
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
```

Запуск с профилем:
```bash
mvn spring-boot:run -Dspring-boot.run.profiles=dev
# или
mvn spring-boot:run -Dspring-boot.run.profiles=prod
```

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\HELP.md] 
 
# Getting Started

### Reference Documentation

For further reference, please consider the following sections:

* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)
* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/3.5.7/maven-plugin)
* [Create an OCI image](https://docs.spring.io/spring-boot/3.5.7/maven-plugin/build-image.html)

### Maven Parent overrides

Due to Maven's design, elements are inherited from the parent POM to the project POM.
While most of the inheritance is fine, it also inherits unwanted elements like `<license>` and `<developers>` from the
parent.
To prevent this, the project POM contains empty overrides for these elements.
If you manually switch to a different parent and actually want the inheritance, you need to remove those overrides.

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\POSTGRES_SETUP.md] 
 
# Настройка PostgreSQL - Решение проблем с подключением

## Ошибка: "пароль пользователя postgres неверный"

Эта ошибка означает, что пароль в `application.properties` не совпадает с паролем пользователя `postgres` в PostgreSQL.

## Решение

### Вариант 1: Узнать/изменить пароль пользователя postgres

#### Windows (через командную строку):
```bash
# Подключитесь к PostgreSQL (может запросить пароль)
psql -U postgres

# Если не знаете пароль, попробуйте сбросить его:
# 1. Найдите файл pg_hba.conf (обычно в C:\Program Files\PostgreSQL\XX\data\)
# 2. Измените метод аутентификации для local на "trust"
# 3. Перезапустите PostgreSQL
# 4. Подключитесь без пароля и установите новый пароль:
ALTER USER postgres WITH PASSWORD 'новый_пароль';
```

#### Linux/macOS:
```bash
# Попробуйте подключиться
sudo -u postgres psql

# Или если знаете пароль
psql -U postgres

# Установить новый пароль
ALTER USER postgres WITH PASSWORD 'новый_пароль';
```

### Вариант 2: Создать нового пользователя с известным паролем

```sql
-- Подключитесь к PostgreSQL (как суперпользователь)
CREATE USER electro_user WITH PASSWORD 'electro123';
ALTER USER electro_user CREATEDB;
GRANT ALL PRIVILEGES ON DATABASE electrodb TO electro_user;
```

Затем измените в `application.properties`:
```properties
spring.datasource.username=electro_user
spring.datasource.password=electro123
```

### Вариант 3: Использовать pgAdmin (графический интерфейс)

1. Откройте pgAdmin
2. Подключитесь к серверу PostgreSQL
3. Правый клик на "Login/Group Roles" → "Create" → "Login/Group Role"
4. Укажите имя и пароль
5. Во вкладке "Privileges" дайте права на создание баз данных
6. Обновите `application.properties` с новыми данными

## Проверка подключения

Перед запуском приложения проверьте подключение:

```bash
psql -U postgres -d electrodb
# или
psql -U ваш_пользователь -d electrodb
```

Если подключение успешно, значит данные верны.

## Создание базы данных

Убедитесь, что база данных `electrodb` создана:

```sql
CREATE DATABASE electrodb;
```

## Обновление application.properties

После того как узнаете правильный пароль, обновите файл:

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/electrodb
spring.datasource.username=postgres  # или ваш_пользователь
spring.datasource.password=ваш_правильный_пароль
```

## Быстрое решение (если забыли пароль)

### Windows:
1. Остановите службу PostgreSQL
2. Найдите файл `pg_hba.conf` в папке данных PostgreSQL
3. Измените строку:
   ```
   # было:
   host    all             all             127.0.0.1/32            md5
   # станет:
   host    all             all             127.0.0.1/32            trust
   ```
4. Запустите службу PostgreSQL
5. Подключитесь без пароля: `psql -U postgres`
6. Установите новый пароль: `ALTER USER postgres WITH PASSWORD 'postgres';`
7. Верните `md5` в `pg_hba.conf` и перезапустите службу

### Linux/macOS:
```bash
sudo -u postgres psql
ALTER USER postgres WITH PASSWORD 'postgres';
\q
```



 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\README.md] 
 
# Web-приложение «Сервис для планирования электросети и подбора оборудования в жилые помещения»

## Описание проекта

Веб-приложение для планирования электросети и подбора электротехнического оборудования в жилые помещения. Разработано на Java с использованием Spring Boot.

## Технологический стек

- **Java 17**
- **Spring Boot 3.5.7**
- **Spring Data JPA** (Code First подход)
- **Spring Security** с JWT аутентификацией
- **H2 Database** (для разработки) / **PostgreSQL** (для продакшена)
- **Lombok**
- **Maven**

## Архитектура проекта

Проект следует принципам чистой архитектуры:

```
src/main/java/com/verchuk/electro/
├── config/              # Конфигурационные классы
├── controller/          # REST контроллеры
├── dto/                 # Data Transfer Objects
│   ├── request/         # DTO для запросов
│   └── response/        # DTO для ответов
├── exception/           # Обработка исключений
├── model/              # Entity классы (JPA)
├── repository/         # Repository интерфейсы
├── security/           # Spring Security конфигурация
└── service/            # Бизнес-логика
```

## Роли пользователей

### Проектировщик (DESIGNER)
- Регистрация (новые пользователи автоматически получают роль DESIGNER)
- Аутентификация
- Создание, изменение, удаление проектов электросети
- Добавление, изменение, удаление жилых помещений в проект
- Просмотр каталога электроприборов
- Добавление, изменение, удаление списка электроприборов проекта
- Получение расчетной ведомости проекта
- Получение спецификации электротехнического оборудования
- Обновление, удаление личного профиля

### Администратор (ADMIN)
- Создание, изменение, удаление пользователей
- Добавление, изменение, удаление электроприборов
- Добавление, удаление типов жилых помещений
- Просмотр проектов электросети
- Просмотр статистики используемых электроприборов

## API Endpoints

### Аутентификация
- `POST /api/auth/register` - Регистрация
- `POST /api/auth/login` - Вход

### Профиль пользователя
- `GET /api/user/profile` - Получить текущий профиль
- `PUT /api/user/profile` - Обновить профиль
- `DELETE /api/user/profile` - Удалить профиль

### Проекты (требует роль DESIGNER)
- `GET /api/designer/projects` - Список проектов
- `GET /api/designer/projects/{id}` - Получить проект
- `POST /api/designer/projects` - Создать проект
- `PUT /api/designer/projects/{id}` - Обновить проект
- `DELETE /api/designer/projects/{id}` - Удалить проект

### Помещения (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/rooms` - Список помещений
- `GET /api/designer/projects/{projectId}/rooms/{roomId}` - Получить помещение
- `POST /api/designer/projects/{projectId}/rooms` - Создать помещение
- `PUT /api/designer/projects/{projectId}/rooms/{roomId}` - Обновить помещение
- `DELETE /api/designer/projects/{projectId}/rooms/{roomId}` - Удалить помещение

### Электроприборы
- `GET /api/appliances` - Каталог электроприборов
- `GET /api/appliances/{id}` - Получить электроприбор

### Электроприборы проекта (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/appliances` - Список электроприборов проекта
- `POST /api/designer/projects/{projectId}/appliances` - Добавить электроприбор
- `PUT /api/designer/projects/{projectId}/appliances/{projectApplianceId}` - Обновить электроприбор
- `DELETE /api/designer/projects/{projectId}/appliances/{projectApplianceId}` - Удалить электроприбор

### Расчеты (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/calculations` - Получить расчетную ведомость

### Спецификации (требует роль DESIGNER)
- `GET /api/designer/projects/{projectId}/specifications` - Получить спецификацию оборудования

### Администратор (требует роль ADMIN)
- `GET /api/admin/users` - Список пользователей
- `GET /api/admin/users/{id}` - Получить пользователя
- `POST /api/admin/users` - Создать пользователя
- `PUT /api/admin/users/{id}` - Обновить пользователя
- `DELETE /api/admin/users/{id}` - Удалить пользователя
- `POST /api/admin/appliances` - Создать электроприбор
- `PUT /api/admin/appliances/{id}` - Обновить электроприбор
- `DELETE /api/admin/appliances/{id}` - Удалить электроприбор
- `GET /api/admin/room-types` - Список типов помещений
- `POST /api/admin/room-types` - Создать тип помещения
- `PUT /api/admin/room-types/{id}` - Обновить тип помещения
- `DELETE /api/admin/room-types/{id}` - Удалить тип помещения
- `GET /api/admin/projects` - Список всех проектов
- `GET /api/admin/projects/{id}` - Получить проект
- `GET /api/admin/statistics/appliances` - Статистика электроприборов

## Запуск приложения

1. Убедитесь, что установлены Java 17 и Maven
2. Клонируйте репозиторий
3. Запустите приложение:
   ```bash
   mvn spring-boot:run
   ```
4. Приложение будет доступно по адресу: `http://localhost:8080`
5. H2 Console доступна по адресу: `http://localhost:8080/h2-console`

## Настройка базы данных

По умолчанию используется H2 in-memory база данных. Для использования PostgreSQL:

1. Раскомментируйте соответствующие строки в `application.properties`
2. Создайте базу данных PostgreSQL
3. Обновите настройки подключения

## JWT Аутентификация

Все защищенные endpoints требуют JWT токен в заголовке:
```
Authorization: Bearer <token>
```

Токен получается при регистрации или входе через `/api/auth/register` или `/api/auth/login`.

## Инициализация данных

При первом запуске автоматически создаются роли:
- DESIGNER
- ADMIN

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\project_code.txt] 
 
 
[ 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\.idea\compiler.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CompilerConfiguration">
    <annotationProcessing>
      <profile default="true" name="Default" enabled="true" />
      <profile name="Maven default annotation processors profile" enabled="true">
        <sourceOutputDir name="target/generated-sources/annotations" />
        <sourceTestOutputDir name="target/generated-test-sources/test-annotations" />
        <outputRelativeToContentRoot value="true" />
        <module name="electro" />
      </profile>
    </annotationProcessing>
  </component>
  <component name="JavacSettings">
    <option name="ADDITIONAL_OPTIONS_OVERRIDE">
      <module name="electro" options="-parameters" />
    </option>
  </component>
</project> 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\.idea\encodings.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="Encoding">
    <file url="file://$PROJECT_DIR$/src/main/java" charset="UTF-8" />
  </component>
</project> 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\.idea\jarRepositories.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="RemoteRepositoriesConfiguration">
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Central Repository" />
      <option name="url" value="https://repo.maven.apache.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="central" />
      <option name="name" value="Maven Central repository" />
      <option name="url" value="https://repo1.maven.org/maven2" />
    </remote-repository>
    <remote-repository>
      <option name="id" value="jboss.community" />
      <option name="name" value="JBoss Community repository" />
      <option name="url" value="https://repository.jboss.org/nexus/content/repositories/public/" />
    </remote-repository>
  </component>
</project> 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\.idea\misc.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ExternalStorageConfigurationManager" enabled="true" />
  <component name="MavenProjectsManager">
    <option name="originalFiles">
      <list>
        <option value="$PROJECT_DIR$/pom.xml" />
      </list>
    </option>
  </component>
  <component name="ProjectRootManager" version="2" languageLevel="JDK_21" default="true" project-jdk-name="21" project-jdk-type="JavaSDK">
    <output url="file://$PROJECT_DIR$/out" />
  </component>
</project> 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\.idea\vcs.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="VcsDirectoryMappings">
    <mapping directory="$PROJECT_DIR$" vcs="Git" />
  </component>
</project> 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\.idea\workspace.xml] 
 
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="8c3d4246-8e0a-4e4c-b004-4d60642f9158" name="Changes" comment="">
      <change afterPath="$PROJECT_DIR$/src/main/java/com/verchuk/electro/controller/RoomTypeController.java" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/src/main/java/com/verchuk/electro/security/AuthEntryPointJwt.java" afterDir="false" />
    </list>
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Class" />
      </list>
    </option>
  </component>
  <component name="Git.Settings">
    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
  </component>
  <component name="MavenImportPreferences">
    <option name="generalSettings">
      <MavenGeneralSettings>
        <option name="mavenHomeTypeForPersistence" value="WRAPPER" />
      </MavenGeneralSettings>
    </option>
  </component>
  <component name="ProjectColorInfo">{
  &quot;associatedIndex&quot;: 0
}</component>
  <component name="ProjectId" id="35CqbB2DmaQfHimLJdug3IstkBg" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent">{
  &quot;keyToString&quot;: {
    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
    &quot;RequestMappingsPanelOrder0&quot;: &quot;0&quot;,
    &quot;RequestMappingsPanelOrder1&quot;: &quot;1&quot;,
    &quot;RequestMappingsPanelWidth0&quot;: &quot;75&quot;,
    &quot;RequestMappingsPanelWidth1&quot;: &quot;75&quot;,
    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
    &quot;Spring Boot.ElectroApplication.executor&quot;: &quot;Run&quot;,
    &quot;dart.analysis.tool.window.visible&quot;: &quot;false&quot;,
    &quot;git-widget-placeholder&quot;: &quot;master&quot;,
    &quot;last_opened_file_path&quot;: &quot;D:/7semestr/Electricity/Project/electro&quot;,
    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
  }
}</component>
  <component name="RunManager">
    <configuration name="ElectroApplication" type="SpringBootApplicationConfigurationType" factoryName="Spring Boot" nameIsGenerated="true">
      <module name="electro" />
      <option name="SPRING_BOOT_MAIN_CLASS" value="com.verchuk.electro.ElectroApplication" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-jdk-9823dce3aa75-fbdcb00ec9e3-intellij.indexing.shared.core-IU-251.26927.53" />
        <option value="bundled-js-predefined-d6986cc7102b-09060db00ec0-JavaScript-IU-251.26927.53" />
      </set>
    </attachedChunks>
  </component>
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="8c3d4246-8e0a-4e4c-b004-4d60642f9158" name="Changes" comment="" />
      <created>1762624549342</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1762624549342</updated>
      <workItem from="1762624550583" duration="4736000" />
      <workItem from="1762859891372" duration="120000" />
      <workItem from="1763728244114" duration="2618000" />
      <workItem from="1763840604495" duration="9036000" />
      <workItem from="1763968390755" duration="233000" />
      <workItem from="1763983979755" duration="42000" />
      <workItem from="1764185746273" duration="623000" />
      <workItem from="1764527599412" duration="6494000" />
      <workItem from="1765282618711" duration="268000" />
      <workItem from="1765442534197" duration="663000" />
      <workItem from="1765460231173" duration="3268000" />
      <workItem from="1765538682040" duration="1437000" />
      <workItem from="1765702796414" duration="5998000" />
      <workItem from="1765821887419" duration="2292000" />
      <workItem from="1766086252095" duration="1684000" />
      <workItem from="1766154706591" duration="3559000" />
      <workItem from="1766170789167" duration="3348000" />
    </task>
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
</project> 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\ElectroApplication.java] 
 
package com.verchuk.electro;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class ElectroApplication {

    public static void main(String[] args) {
        SpringApplication.run(ElectroApplication.class, args);
    }

}
 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\config\DataInitializer.java] 
 
package com.verchuk.electro.config;

import com.verchuk.electro.model.Role;
import com.verchuk.electro.model.User;
import com.verchuk.electro.repository.RoleRepository;
import com.verchuk.electro.repository.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Component;

import java.util.HashSet;
import java.util.Set;

@Component
public class DataInitializer implements CommandLineRunner {
    @Autowired
    private RoleRepository roleRepository;

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Override
    public void run(String... args) {
        // Создание ролей
        if (roleRepository.count() == 0) {
            roleRepository.save(Role.builder().name(Role.RoleName.DESIGNER).build());
            roleRepository.save(Role.builder().name(Role.RoleName.ADMIN).build());
        }

        // Создание администратора по умолчанию
        if (!userRepository.existsByUsername("admin")) {
            Role adminRole = roleRepository.findByName(Role.RoleName.ADMIN)
                    .orElseThrow(() -> new RuntimeException("Admin role not found"));

            Set<Role> roles = new HashSet<>();
            roles.add(adminRole);

            User admin = User.builder()
                    .username("admin")
                    .email("admin@electro.local")
                    .password(passwordEncoder.encode("admin123"))
                    .firstName("Admin")
                    .lastName("User")
                    .enabled(true)
                    .roles(roles)
                    .build();

            userRepository.save(admin);
            System.out.println("Default admin user created: username=admin, password=admin123");
        }
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\AdminController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.ApplianceRequest;
import com.verchuk.electro.dto.request.RegisterRequest;
import com.verchuk.electro.dto.request.RoomTypeRequest;
import com.verchuk.electro.dto.request.UserUpdateRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.ApplianceResponse;
import com.verchuk.electro.dto.response.ApplianceStatisticsResponse;
import com.verchuk.electro.dto.response.ProjectResponse;
import com.verchuk.electro.dto.response.RoomTypeResponse;
import com.verchuk.electro.dto.response.UserResponse;
import com.verchuk.electro.service.ApplianceService;
import com.verchuk.electro.service.ProjectService;
import com.verchuk.electro.service.RoomTypeService;
import com.verchuk.electro.service.StatisticsService;
import com.verchuk.electro.service.UserService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/admin")
public class AdminController {
    @Autowired
    private UserService userService;

    @Autowired
    private ApplianceService applianceService;

    @Autowired
    private RoomTypeService roomTypeService;

    @Autowired
    private ProjectService projectService;

    @Autowired
    private StatisticsService statisticsService;

    // User Management
    @GetMapping("/users")
    public ResponseEntity<List<UserResponse>> getAllUsers() {
        return ResponseEntity.ok(userService.getAllUsers());
    }

    @GetMapping("/users/{id}")
    public ResponseEntity<UserResponse> getUserById(@PathVariable Long id) {
        return ResponseEntity.ok(userService.getUserById(id));
    }

    @PostMapping("/users")
    public ResponseEntity<UserResponse> createUser(@Valid @RequestBody RegisterRequest request,
                                                   @RequestParam(required = false) List<String> roles) {
        if (roles == null || roles.isEmpty()) {
            roles = List.of("DESIGNER");
        }
        return ResponseEntity.ok(userService.createUser(request, roles));
    }

    @PutMapping("/users/{id}")
    public ResponseEntity<UserResponse> updateUser(@PathVariable Long id,
                                                   @Valid @RequestBody UserUpdateRequest request,
                                                   @RequestParam(required = false) List<String> roles) {
        return ResponseEntity.ok(userService.updateUser(id, request, roles));
    }

    @DeleteMapping("/users/{id}")
    public ResponseEntity<ApiResponse> deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
        return ResponseEntity.ok(ApiResponse.success("User deleted successfully"));
    }

    // Appliance Management
    @PostMapping("/appliances")
    public ResponseEntity<ApplianceResponse> createAppliance(@Valid @RequestBody ApplianceRequest request) {
        return ResponseEntity.ok(applianceService.createAppliance(request));
    }

    @PutMapping("/appliances/{id}")
    public ResponseEntity<ApplianceResponse> updateAppliance(@PathVariable Long id,
                                                              @Valid @RequestBody ApplianceRequest request) {
        return ResponseEntity.ok(applianceService.updateAppliance(id, request));
    }

    @DeleteMapping("/appliances/{id}")
    public ResponseEntity<ApiResponse> deleteAppliance(@PathVariable Long id) {
        applianceService.deleteAppliance(id);
        return ResponseEntity.ok(ApiResponse.success("Appliance deleted successfully"));
    }

    // Room Type Management
    @GetMapping("/room-types")
    public ResponseEntity<List<RoomTypeResponse>> getAllRoomTypes() {
        return ResponseEntity.ok(roomTypeService.getAllRoomTypes());
    }

    @PostMapping("/room-types")
    public ResponseEntity<RoomTypeResponse> createRoomType(@Valid @RequestBody RoomTypeRequest request) {
        return ResponseEntity.ok(roomTypeService.createRoomType(request));
    }

    @PutMapping("/room-types/{id}")
    public ResponseEntity<RoomTypeResponse> updateRoomType(@PathVariable Long id,
                                                           @Valid @RequestBody RoomTypeRequest request) {
        return ResponseEntity.ok(roomTypeService.updateRoomType(id, request));
    }

    @DeleteMapping("/room-types/{id}")
    public ResponseEntity<ApiResponse> deleteRoomType(@PathVariable Long id) {
        roomTypeService.deleteRoomType(id);
        return ResponseEntity.ok(ApiResponse.success("Room type deleted successfully"));
    }

    // Project Viewing
    @GetMapping("/projects")
    public ResponseEntity<List<ProjectResponse>> getAllProjects() {
        return ResponseEntity.ok(projectService.getAllProjects());
    }

    @GetMapping("/projects/{id}")
    public ResponseEntity<ProjectResponse> getProjectById(@PathVariable Long id) {
        return ResponseEntity.ok(projectService.getProjectById(id));
    }

    // Statistics
    @GetMapping("/statistics/appliances")
    public ResponseEntity<List<ApplianceStatisticsResponse>> getApplianceStatistics() {
        return ResponseEntity.ok(statisticsService.getApplianceStatistics());
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\ApplianceController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.ApplianceRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.ApplianceResponse;
import com.verchuk.electro.service.ApplianceService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/appliances")
public class ApplianceController {
    @Autowired
    private ApplianceService applianceService;

    @GetMapping
    public ResponseEntity<List<ApplianceResponse>> getAllActiveAppliances() {
        return ResponseEntity.ok(applianceService.getAllActiveAppliances());
    }

    @GetMapping("/{id}")
    public ResponseEntity<ApplianceResponse> getApplianceById(@PathVariable Long id) {
        return ResponseEntity.ok(applianceService.getApplianceById(id));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\AuthController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.LoginRequest;
import com.verchuk.electro.dto.request.RegisterRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.JwtResponse;
import com.verchuk.electro.service.AuthService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/auth")
public class AuthController {
    @Autowired
    private AuthService authService;

    @PostMapping("/register")
    public ResponseEntity<JwtResponse> register(@Valid @RequestBody RegisterRequest request) {
        return ResponseEntity.ok(authService.register(request));
    }

    @PostMapping("/login")
    public ResponseEntity<JwtResponse> login(@Valid @RequestBody LoginRequest request) {
        return ResponseEntity.ok(authService.login(request));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\CalculationController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.response.CalculationReportResponse;
import com.verchuk.electro.service.CalculationService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects/{projectId}/calculations")
public class CalculationController {
    @Autowired
    private CalculationService calculationService;

    @GetMapping
    public ResponseEntity<CalculationReportResponse> getCalculationReport(@PathVariable Long projectId) {
        return ResponseEntity.ok(calculationService.getCalculationReport(projectId));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\ElectricalPointController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.ElectricalPointRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.ElectricalPointResponse;
import com.verchuk.electro.service.ElectricalPointService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects/{projectId}/electrical-points")
public class ElectricalPointController {
    @Autowired
    private ElectricalPointService electricalPointService;

    @GetMapping
    public ResponseEntity<List<ElectricalPointResponse>> getElectricalPoints(@PathVariable Long projectId) {
        var floorPlan = electricalPointService.getFloorPlanForProject(projectId);
        return ResponseEntity.ok(electricalPointService.getElectricalPointsByFloorPlan(floorPlan.getId()));
    }

    @PostMapping
    public ResponseEntity<ElectricalPointResponse> createElectricalPoint(
            @PathVariable Long projectId,
            @Valid @RequestBody ElectricalPointRequest request) {
        return ResponseEntity.ok(electricalPointService.createElectricalPoint(projectId, request));
    }

    @PostMapping("/batch")
    public ResponseEntity<List<ElectricalPointResponse>> saveElectricalPoints(
            @PathVariable Long projectId,
            @Valid @RequestBody List<ElectricalPointRequest> requests) {
        return ResponseEntity.ok(electricalPointService.saveElectricalPoints(projectId, requests));
    }

    @PutMapping("/{pointId}")
    public ResponseEntity<ElectricalPointResponse> updateElectricalPoint(
            @PathVariable Long projectId,
            @PathVariable Long pointId,
            @Valid @RequestBody ElectricalPointRequest request) {
        return ResponseEntity.ok(electricalPointService.updateElectricalPoint(projectId, pointId, request));
    }

    @DeleteMapping("/{pointId}")
    public ResponseEntity<ApiResponse> deleteElectricalPoint(
            @PathVariable Long projectId,
            @PathVariable Long pointId) {
        electricalPointService.deleteElectricalPoint(projectId, pointId);
        return ResponseEntity.ok(ApiResponse.success("Electrical point deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\ElectricalSymbolController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.ElectricalSymbolRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.ElectricalSymbolResponse;
import com.verchuk.electro.service.ElectricalSymbolService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api")
public class ElectricalSymbolController {
    @Autowired
    private ElectricalSymbolService electricalSymbolService;

    @GetMapping("/electrical-symbols")
    public ResponseEntity<List<ElectricalSymbolResponse>> getAllSymbols() {
        return ResponseEntity.ok(electricalSymbolService.getAllSymbols());
    }

    @GetMapping("/electrical-symbols/type/{type}")
    public ResponseEntity<List<ElectricalSymbolResponse>> getSymbolsByType(@PathVariable String type) {
        return ResponseEntity.ok(electricalSymbolService.getSymbolsByType(type));
    }

    @GetMapping("/electrical-symbols/category/{category}")
    public ResponseEntity<List<ElectricalSymbolResponse>> getSymbolsByCategory(@PathVariable String category) {
        return ResponseEntity.ok(electricalSymbolService.getSymbolsByCategory(category));
    }

    @GetMapping("/electrical-symbols/{id}")
    public ResponseEntity<ElectricalSymbolResponse> getSymbolById(@PathVariable Long id) {
        return ResponseEntity.ok(electricalSymbolService.getSymbolById(id));
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/admin/electrical-symbols")
    public ResponseEntity<ElectricalSymbolResponse> createSymbol(@Valid @RequestBody ElectricalSymbolRequest request) {
        return ResponseEntity.ok(electricalSymbolService.createSymbol(request));
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PutMapping("/admin/electrical-symbols/{id}")
    public ResponseEntity<ElectricalSymbolResponse> updateSymbol(
            @PathVariable Long id,
            @Valid @RequestBody ElectricalSymbolRequest request) {
        return ResponseEntity.ok(electricalSymbolService.updateSymbol(id, request));
    }

    @PreAuthorize("hasRole('ADMIN')")
    @DeleteMapping("/admin/electrical-symbols/{id}")
    public ResponseEntity<ApiResponse> deleteSymbol(@PathVariable Long id) {
        electricalSymbolService.deleteSymbol(id);
        return ResponseEntity.ok(ApiResponse.success("Electrical symbol deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\FileController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.service.FileService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.Resource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/files")
public class FileController {
    @Autowired
    private FileService fileService;

    @PostMapping("/upload")
    public ResponseEntity<ApiResponse> uploadFile(@RequestParam("file") MultipartFile file,
                                                  @RequestParam(value = "type", defaultValue = "general") String type) {
        try {
            String filename = fileService.saveFile(file, type);
            String fileUrl = "/api/files/" + filename;
            return ResponseEntity.ok(ApiResponse.success("File uploaded successfully", fileUrl));
        } catch (IOException e) {
            return ResponseEntity.badRequest()
                    .body(ApiResponse.error("Failed to upload file: " + e.getMessage()));
        }
    }

    @GetMapping("/{filename:.+}")
    public ResponseEntity<Resource> getFile(@PathVariable String filename) {
        try {
            System.out.println("Request to load file: " + filename);
            Resource resource = fileService.loadFile(filename);
            if (resource.exists() && resource.isReadable()) {
                String contentType = "application/octet-stream";
                try {
                    contentType = fileService.getContentType(filename);
                    if (contentType == null || contentType.isEmpty()) {
                        // Определяем по расширению
                        if (filename.toLowerCase().endsWith(".png")) {
                            contentType = "image/png";
                        } else if (filename.toLowerCase().endsWith(".jpg") || filename.toLowerCase().endsWith(".jpeg")) {
                            contentType = "image/jpeg";
                        } else if (filename.toLowerCase().endsWith(".gif")) {
                            contentType = "image/gif";
                        } else if (filename.toLowerCase().endsWith(".webp")) {
                            contentType = "image/webp";
                        }
                    }
                } catch (IOException e) {
                    System.out.println("Error getting content type: " + e.getMessage());
                    // Используем дефолтный тип
                }

                System.out.println("Returning file with content type: " + contentType);
                return ResponseEntity.ok()
                        .contentType(MediaType.parseMediaType(contentType))
                        .header(HttpHeaders.CONTENT_DISPOSITION, "inline; filename=\"" + resource.getFilename() + "\"")
                        .header(HttpHeaders.CACHE_CONTROL, "public, max-age=3600")
                        .body(resource);
            } else {
                System.out.println("Resource exists: " + resource.exists() + ", readable: " + resource.isReadable());
                return ResponseEntity.notFound().build();
            }
        } catch (IOException e) {
            System.out.println("Error loading file: " + e.getMessage());
            e.printStackTrace();
            return ResponseEntity.notFound().build();
        }
    }

    @DeleteMapping("/{filename:.+}")
    public ResponseEntity<ApiResponse> deleteFile(@PathVariable String filename) {
        try {
            fileService.deleteFile(filename);
            return ResponseEntity.ok(ApiResponse.success("File deleted successfully"));
        } catch (IOException e) {
            return ResponseEntity.badRequest()
                    .body(ApiResponse.error("Failed to delete file: " + e.getMessage()));
        }
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\FloorPlanController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.FloorPlanRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.FloorPlanResponse;
import com.verchuk.electro.service.FloorPlanService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects/{projectId}/floor-plan")
public class FloorPlanController {
    @Autowired
    private FloorPlanService floorPlanService;

    @GetMapping
    public ResponseEntity<FloorPlanResponse> getFloorPlan(@PathVariable Long projectId) {
        return ResponseEntity.ok(floorPlanService.getFloorPlan(projectId));
    }

    @PostMapping
    public ResponseEntity<FloorPlanResponse> createOrUpdateFloorPlan(
            @PathVariable Long projectId,
            @Valid @RequestBody FloorPlanRequest request) {
        return ResponseEntity.ok(floorPlanService.createOrUpdateFloorPlan(projectId, request));
    }

    @PutMapping
    public ResponseEntity<FloorPlanResponse> updateFloorPlan(
            @PathVariable Long projectId,
            @Valid @RequestBody FloorPlanRequest request) {
        return ResponseEntity.ok(floorPlanService.createOrUpdateFloorPlan(projectId, request));
    }

    @DeleteMapping
    public ResponseEntity<ApiResponse> deleteFloorPlan(@PathVariable Long projectId) {
        floorPlanService.deleteFloorPlan(projectId);
        return ResponseEntity.ok(ApiResponse.success("Floor plan deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\ProjectApplianceController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.ProjectApplianceRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.ProjectApplianceResponse;
import com.verchuk.electro.service.ProjectApplianceService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects/{projectId}/appliances")
public class ProjectApplianceController {
    @Autowired
    private ProjectApplianceService projectApplianceService;

    @GetMapping
    public ResponseEntity<List<ProjectApplianceResponse>> getProjectAppliances(@PathVariable Long projectId) {
        return ResponseEntity.ok(projectApplianceService.getProjectAppliances(projectId));
    }

    @PostMapping
    public ResponseEntity<ProjectApplianceResponse> addProjectAppliance(@PathVariable Long projectId,
                                                                          @Valid @RequestBody ProjectApplianceRequest request) {
        return ResponseEntity.ok(projectApplianceService.addProjectAppliance(projectId, request));
    }

    @PutMapping("/{projectApplianceId}")
    public ResponseEntity<ProjectApplianceResponse> updateProjectAppliance(@PathVariable Long projectId,
                                                                           @PathVariable Long projectApplianceId,
                                                                           @Valid @RequestBody ProjectApplianceRequest request) {
        return ResponseEntity.ok(projectApplianceService.updateProjectAppliance(projectId, projectApplianceId, request));
    }

    @DeleteMapping("/{projectApplianceId}")
    public ResponseEntity<ApiResponse> deleteProjectAppliance(@PathVariable Long projectId,
                                                              @PathVariable Long projectApplianceId) {
        projectApplianceService.deleteProjectAppliance(projectId, projectApplianceId);
        return ResponseEntity.ok(ApiResponse.success("Project appliance deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\ProjectController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.ProjectRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.ProjectResponse;
import com.verchuk.electro.service.ProjectService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects")
public class ProjectController {
    @Autowired
    private ProjectService projectService;

    @GetMapping
    public ResponseEntity<List<ProjectResponse>> getAllProjects() {
        return ResponseEntity.ok(projectService.getAllProjectsForCurrentUser());
    }

    @GetMapping("/{id}")
    public ResponseEntity<ProjectResponse> getProjectById(@PathVariable Long id) {
        return ResponseEntity.ok(projectService.getProjectByIdForCurrentUser(id));
    }

    @PostMapping
    public ResponseEntity<ProjectResponse> createProject(@Valid @RequestBody ProjectRequest request) {
        return ResponseEntity.ok(projectService.createProject(request));
    }

    @PutMapping("/{id}")
    public ResponseEntity<ProjectResponse> updateProject(@PathVariable Long id, @Valid @RequestBody ProjectRequest request) {
        return ResponseEntity.ok(projectService.updateProject(id, request));
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<ApiResponse> deleteProject(@PathVariable Long id) {
        projectService.deleteProject(id);
        return ResponseEntity.ok(ApiResponse.success("Project deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\RoomController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.RoomRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.RoomResponse;
import com.verchuk.electro.service.RoomService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects/{projectId}/rooms")
public class RoomController {
    @Autowired
    private RoomService roomService;

    @GetMapping
    public ResponseEntity<List<RoomResponse>> getRoomsByProject(@PathVariable Long projectId) {
        return ResponseEntity.ok(roomService.getRoomsByProject(projectId));
    }

    @GetMapping("/{roomId}")
    public ResponseEntity<RoomResponse> getRoomById(@PathVariable Long projectId, @PathVariable Long roomId) {
        return ResponseEntity.ok(roomService.getRoomById(projectId, roomId));
    }

    @PostMapping
    public ResponseEntity<RoomResponse> createRoom(@PathVariable Long projectId, @Valid @RequestBody RoomRequest request) {
        return ResponseEntity.ok(roomService.createRoom(projectId, request));
    }

    @PutMapping("/{roomId}")
    public ResponseEntity<RoomResponse> updateRoom(@PathVariable Long projectId, @PathVariable Long roomId,
                                                    @Valid @RequestBody RoomRequest request) {
        return ResponseEntity.ok(roomService.updateRoom(projectId, roomId, request));
    }

    @DeleteMapping("/{roomId}")
    public ResponseEntity<ApiResponse> deleteRoom(@PathVariable Long projectId, @PathVariable Long roomId) {
        roomService.deleteRoom(projectId, roomId);
        return ResponseEntity.ok(ApiResponse.success("Room deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\RoomTypeController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.response.RoomTypeResponse;
import com.verchuk.electro.service.RoomTypeService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/room-types") // Обрати внимание: не /api/admin/room-types
public class RoomTypeController {

    @Autowired
    private RoomTypeService roomTypeService;

    @GetMapping
    public ResponseEntity<List<RoomTypeResponse>> getAllRoomTypes() {
        return ResponseEntity.ok(roomTypeService.getAllRoomTypes());
    }
} 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\SpecificationController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.response.SpecificationResponse;
import com.verchuk.electro.service.SpecificationService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects/{projectId}/specifications")
public class SpecificationController {
    @Autowired
    private SpecificationService specificationService;

    @GetMapping
    public ResponseEntity<SpecificationResponse> getSpecification(@PathVariable Long projectId) {
        return ResponseEntity.ok(specificationService.getSpecification(projectId));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\UserController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.UserUpdateRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.UserResponse;
import com.verchuk.electro.service.UserService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/user")
public class UserController {
    @Autowired
    private UserService userService;

    @GetMapping("/profile")
    public ResponseEntity<UserResponse> getCurrentUserProfile() {
        return ResponseEntity.ok(userService.getCurrentUserProfile());
    }

    @PutMapping("/profile")
    public ResponseEntity<UserResponse> updateCurrentUserProfile(@Valid @RequestBody UserUpdateRequest request) {
        return ResponseEntity.ok(userService.updateCurrentUserProfile(request));
    }

    @DeleteMapping("/profile")
    public ResponseEntity<ApiResponse> deleteCurrentUser() {
        userService.deleteCurrentUser();
        return ResponseEntity.ok(ApiResponse.success("User deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\controller\WallController.java] 
 
package com.verchuk.electro.controller;

import com.verchuk.electro.dto.request.WallRequest;
import com.verchuk.electro.dto.response.ApiResponse;
import com.verchuk.electro.dto.response.WallResponse;
import com.verchuk.electro.service.WallService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
@RequestMapping("/api/designer/projects/{projectId}/walls")
public class WallController {
    @Autowired
    private WallService wallService;

    @GetMapping
    public ResponseEntity<List<WallResponse>> getWalls(@PathVariable Long projectId) {
        var floorPlan = wallService.getFloorPlanForProject(projectId);
        return ResponseEntity.ok(wallService.getWallsByFloorPlan(floorPlan.getId()));
    }

    @PostMapping
    public ResponseEntity<WallResponse> createWall(
            @PathVariable Long projectId,
            @Valid @RequestBody WallRequest request) {
        return ResponseEntity.ok(wallService.createWall(projectId, request));
    }

    @PostMapping("/batch")
    public ResponseEntity<List<WallResponse>> saveWalls(
            @PathVariable Long projectId,
            @Valid @RequestBody List<WallRequest> requests) {
        return ResponseEntity.ok(wallService.saveWalls(projectId, requests));
    }

    @PutMapping("/{wallId}")
    public ResponseEntity<WallResponse> updateWall(
            @PathVariable Long projectId,
            @PathVariable Long wallId,
            @Valid @RequestBody WallRequest request) {
        return ResponseEntity.ok(wallService.updateWall(projectId, wallId, request));
    }

    @DeleteMapping("/{wallId}")
    public ResponseEntity<ApiResponse> deleteWall(
            @PathVariable Long projectId,
            @PathVariable Long wallId) {
        wallService.deleteWall(projectId, wallId);
        return ResponseEntity.ok(ApiResponse.success("Wall deleted successfully"));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\ApplianceRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Positive;
import jakarta.validation.constraints.Size;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ApplianceRequest {
    @NotBlank(message = "Appliance name is required")
    @Size(max = 100, message = "Appliance name must not exceed 100 characters")
    private String name;

    @Size(max = 500, message = "Description must not exceed 500 characters")
    private String description;

    @NotNull(message = "Power consumption is required")
    @Positive(message = "Power consumption must be positive")
    private BigDecimal powerConsumption;

    @Positive(message = "Voltage must be positive")
    private BigDecimal voltage;

    @Positive(message = "Current must be positive")
    private BigDecimal current;

    @Size(max = 50, message = "Category must not exceed 50 characters")
    private String category;

    @Size(max = 500, message = "Image URL must not exceed 500 characters")
    private String imageUrl;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\ElectricalPointRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotNull;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ElectricalPointRequest {
    @NotNull(message = "Electrical symbol ID is required")
    private Long electricalSymbolId;

    private Long roomId;

    @NotNull(message = "Position X is required")
    private BigDecimal positionX;

    @NotNull(message = "Position Y is required")
    private BigDecimal positionY;

    private BigDecimal heightFromFloor;
    private BigDecimal rotation;
    private String group;
    private String notes;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\ElectricalSymbolRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ElectricalSymbolRequest {
    @NotBlank(message = "Name is required")
    private String name;

    private String svgPath;

    @NotBlank(message = "Type is required")
    private String type;

    private String category;
    private Double defaultWidth;
    private Double defaultHeight;
    private Boolean active;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\FloorPlanRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.DecimalMin;
import jakarta.validation.constraints.NotNull;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class FloorPlanRequest {
    @NotNull(message = "Width is required")
    @DecimalMin(value = "100.0", message = "Width must be at least 100 cm")
    private BigDecimal width;

    @NotNull(message = "Height is required")
    @DecimalMin(value = "100.0", message = "Height must be at least 100 cm")
    private BigDecimal height;

    @DecimalMin(value = "0.1", message = "Scale must be positive")
    private BigDecimal scale;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\LoginRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotBlank;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class LoginRequest {
    @NotBlank(message = "Username is required")
    private String username;

    @NotBlank(message = "Password is required")
    private String password;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\ProjectApplianceRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Positive;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ProjectApplianceRequest {
    @NotNull(message = "Appliance ID is required")
    private Long applianceId;

    private Long roomId;

    @NotNull(message = "Quantity is required")
    @Positive(message = "Quantity must be positive")
    private Integer quantity;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\ProjectRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ProjectRequest {
    @NotBlank(message = "Project name is required")
    @Size(max = 100, message = "Project name must not exceed 100 characters")
    private String name;

    @Size(max = 1000, message = "Description must not exceed 1000 characters")
    private String description;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\RegisterRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class RegisterRequest {
    @NotBlank(message = "Username is required")
    @Size(min = 3, max = 50, message = "Username must be between 3 and 50 characters")
    private String username;

    @NotBlank(message = "Email is required")
    @Email(message = "Email should be valid")
    @Size(max = 100, message = "Email must not exceed 100 characters")
    private String email;

    @NotBlank(message = "Password is required")
    @Size(min = 6, max = 100, message = "Password must be between 6 and 100 characters")
    private String password;

    @Size(max = 50, message = "First name must not exceed 50 characters")
    private String firstName;

    @Size(max = 50, message = "Last name must not exceed 50 characters")
    private String lastName;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\RoomPositionRequest.java] 
 
package com.verchuk.electro.dto.request;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class RoomPositionRequest {
    private BigDecimal positionX;
    private BigDecimal positionY;
    private BigDecimal width;
    private BigDecimal height;
    private String polygonPoints; // JSON строка с массивом точек
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\RoomRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Positive;
import jakarta.validation.constraints.Size;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class RoomRequest {
    @NotBlank(message = "Room name is required")
    @Size(max = 100, message = "Room name must not exceed 100 characters")
    private String name;

    @NotNull(message = "Room type ID is required")
    private Long roomTypeId;

    @Positive(message = "Area must be positive")
    private BigDecimal area;

    @Size(max = 500, message = "Description must not exceed 500 characters")
    private String description;

    // Координаты для визуального отображения
    private BigDecimal positionX;
    private BigDecimal positionY;
    private BigDecimal width;
    private BigDecimal height;
    private String polygonPoints; // JSON массив точек для полигона
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\RoomTypeRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class RoomTypeRequest {
    @NotBlank(message = "Room type name is required")
    @Size(max = 100, message = "Room type name must not exceed 100 characters")
    private String name;

    @Size(max = 500, message = "Description must not exceed 500 characters")
    private String description;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\UserUpdateRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.Size;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class UserUpdateRequest {
    @Email(message = "Email should be valid")
    @Size(max = 100, message = "Email must not exceed 100 characters")
    private String email;

    @Size(max = 50, message = "First name must not exceed 50 characters")
    private String firstName;

    @Size(max = 50, message = "Last name must not exceed 50 characters")
    private String lastName;

    @Size(max = 500, message = "Photo URL must not exceed 500 characters")
    private String photoUrl;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\WallOpeningRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotNull;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class WallOpeningRequest {
    @NotNull(message = "Position is required")
    private BigDecimal position;

    @NotNull(message = "Width is required")
    private BigDecimal width;

    private BigDecimal height;
    private String openingType;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\request\WallRequest.java] 
 
package com.verchuk.electro.dto.request;

import jakarta.validation.constraints.NotNull;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class WallRequest {
    @NotNull(message = "Start X is required")
    private BigDecimal startX;

    @NotNull(message = "Start Y is required")
    private BigDecimal startY;

    @NotNull(message = "End X is required")
    private BigDecimal endX;

    @NotNull(message = "End Y is required")
    private BigDecimal endY;

    private BigDecimal thickness;
    private String wallType;
    private List<WallOpeningRequest> openings;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ApiResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ApiResponse {
    private Boolean success;
    private String message;
    private Object data;

    public static ApiResponse success(String message) {
        return new ApiResponse(true, message, null);
    }

    public static ApiResponse success(String message, Object data) {
        return new ApiResponse(true, message, data);
    }

    public static ApiResponse error(String message) {
        return new ApiResponse(false, message, null);
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ApplianceResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ApplianceResponse {
    private Long id;
    private String name;
    private String description;
    private BigDecimal powerConsumption;
    private BigDecimal voltage;
    private BigDecimal current;
    private String category;
    private String imageUrl;
    private Boolean active;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ApplianceStatisticsResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ApplianceStatisticsResponse {
    private Long applianceId;
    private String applianceName;
    private Long usageCount;
    private BigDecimal totalPowerConsumption;
    private Integer projectsCount;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ApplianceSummaryResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ApplianceSummaryResponse {
    private Long applianceId;
    private String applianceName;
    private Integer totalQuantity;
    private BigDecimal totalPower;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\CalculationReportResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class CalculationReportResponse {
    private Long projectId;
    private String projectName;
    private BigDecimal totalPowerConsumption;
    private BigDecimal totalCurrent;
    private Integer totalAppliances;
    private List<RoomCalculationResponse> roomCalculations;
    private List<ApplianceSummaryResponse> applianceSummaries;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ElectricalPointResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ElectricalPointResponse {
    private Long id;
    private Long roomId;
    private String roomName;
    private ElectricalSymbolResponse electricalSymbol;
    private BigDecimal positionX;
    private BigDecimal positionY;
    private BigDecimal heightFromFloor;
    private BigDecimal rotation;
    private String group;
    private String notes;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ElectricalSymbolResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ElectricalSymbolResponse {
    private Long id;
    private String name;
    private String svgPath;
    private String type;
    private String category;
    private Double defaultWidth;
    private Double defaultHeight;
    private Boolean active;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\EquipmentItemResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class EquipmentItemResponse {
    private String category;
    private String name;
    private String specification;
    private Integer quantity;
    private String notes;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\FloorPlanResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class FloorPlanResponse {
    private Long id;
    private Long projectId;
    private BigDecimal width;
    private BigDecimal height;
    private BigDecimal scale;
    private List<WallResponse> walls;
    private List<ElectricalPointResponse> electricalPoints;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\JwtResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class JwtResponse {
    private String token;
    private String type = "Bearer";
    private Long id;
    private String username;
    private String email;
    private List<String> roles;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\PlacementRuleResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class PlacementRuleResponse {
    private Long id;
    private String type;
    private String description;
    private BigDecimal minDistanceFromFloor;
    private BigDecimal maxDistanceFromFloor;
    private BigDecimal recommendedHeight;
    private BigDecimal minDistanceFromDoor;
    private BigDecimal minDistanceBetween;
    private Boolean active;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ProjectApplianceResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ProjectApplianceResponse {
    private Long id;
    private Long applianceId;
    private String applianceName;
    private Long roomId;
    private String roomName;
    private Integer quantity;
    private BigDecimal totalPower;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\ProjectResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ProjectResponse {
    private Long id;
    private String name;
    private String description;
    private Long designerId;
    private String designerUsername;
    private List<RoomResponse> rooms;
    private List<ProjectApplianceResponse> appliances;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\RoomCalculationResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class RoomCalculationResponse {
    private Long roomId;
    private String roomName;
    private BigDecimal totalPower;
    private Integer applianceCount;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\RoomResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class RoomResponse {
    private Long id;
    private String name;
    private BigDecimal area;
    private Long roomTypeId;
    private String roomTypeName;
    private String description;
    private BigDecimal positionX;
    private BigDecimal positionY;
    private BigDecimal width;
    private BigDecimal height;
    private String polygonPoints;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\RoomTypeResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class RoomTypeResponse {
    private Long id;
    private String name;
    private String description;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\SpecificationResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class SpecificationResponse {
    private Long projectId;
    private String projectName;
    private List<EquipmentItemResponse> equipmentItems;
    private String recommendations;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\UserResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.Set;
import java.util.stream.Collectors;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class UserResponse {
    private Long id;
    private String username;
    private String email;
    private String firstName;
    private String lastName;
    private String photoUrl;
    private Set<String> roles;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    private Boolean enabled;

    public static UserResponse fromUser(com.verchuk.electro.model.User user) {
        return UserResponse.builder()
                .id(user.getId())
                .username(user.getUsername())
                .email(user.getEmail())
                .firstName(user.getFirstName())
                .lastName(user.getLastName())
                .photoUrl(user.getPhotoUrl())
                .roles(user.getRoles().stream()
                        .map(role -> role.getName().name())
                        .collect(Collectors.toSet()))
                .createdAt(user.getCreatedAt())
                .updatedAt(user.getUpdatedAt())
                .enabled(user.getEnabled())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\WallOpeningResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class WallOpeningResponse {
    private Long id;
    private BigDecimal position;
    private BigDecimal width;
    private BigDecimal height;
    private String openingType;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\dto\response\WallResponse.java] 
 
package com.verchuk.electro.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class WallResponse {
    private Long id;
    private BigDecimal startX;
    private BigDecimal startY;
    private BigDecimal endX;
    private BigDecimal endY;
    private BigDecimal thickness;
    private String wallType;
    private List<WallOpeningResponse> openings;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\exception\BadRequestException.java] 
 
package com.verchuk.electro.exception;

public class BadRequestException extends RuntimeException {
    public BadRequestException(String message) {
        super(message);
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\exception\GlobalExceptionHandler.java] 
 
package com.verchuk.electro.exception;

import com.verchuk.electro.dto.response.ApiResponse;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import java.util.HashMap;
import java.util.Map;

@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ApiResponse> handleResourceNotFoundException(ResourceNotFoundException ex) {
        return ResponseEntity.status(HttpStatus.NOT_FOUND)
                .body(ApiResponse.error(ex.getMessage()));
    }

    @ExceptionHandler(BadRequestException.class)
    public ResponseEntity<ApiResponse> handleBadRequestException(BadRequestException ex) {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST)
                .body(ApiResponse.error(ex.getMessage()));
    }

    @ExceptionHandler(BadCredentialsException.class)
    public ResponseEntity<ApiResponse> handleBadCredentialsException(BadCredentialsException ex) {
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
                .body(ApiResponse.error("Invalid username or password"));
    }

    @ExceptionHandler(AccessDeniedException.class)
    public ResponseEntity<ApiResponse> handleAccessDeniedException(AccessDeniedException ex) {
        return ResponseEntity.status(HttpStatus.FORBIDDEN)
                .body(ApiResponse.error("Access denied"));
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<Map<String, String>> handleValidationExceptions(MethodArgumentNotValidException ex) {
        Map<String, String> errors = new HashMap<>();
        ex.getBindingResult().getAllErrors().forEach((error) -> {
            String fieldName = ((FieldError) error).getField();
            String errorMessage = error.getDefaultMessage();
            errors.put(fieldName, errorMessage);
        });
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errors);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse> handleGlobalException(Exception ex) {
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(ApiResponse.error("An error occurred: " + ex.getMessage()));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\exception\ResourceNotFoundException.java] 
 
package com.verchuk.electro.exception;

public class ResourceNotFoundException extends RuntimeException {
    public ResourceNotFoundException(String message) {
        super(message);
    }

    public ResourceNotFoundException(String resourceName, String fieldName, Object fieldValue) {
        super(String.format("%s not found with %s : '%s'", resourceName, fieldName, fieldValue));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\Appliance.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Entity
@Table(name = "appliances")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Appliance {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 100)
    private String name;

    @Column(length = 500)
    private String description;

    @Column(name = "power_consumption", precision = 10, scale = 2, nullable = false)
    private BigDecimal powerConsumption;

    @Column(name = "voltage", precision = 5, scale = 2)
    private BigDecimal voltage;

    @Column(name = "current", precision = 10, scale = 2)
    private BigDecimal current;

    @Column(name = "category", length = 50)
    private String category;

    @Column(name = "image_url", length = 500)
    private String imageUrl;

    @Column(nullable = false)
    @Builder.Default
    private Boolean active = true;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\ElectricalPoint.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Entity
@Table(name = "electrical_points")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ElectricalPoint {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "floor_plan_id", nullable = false)
    private FloorPlan floorPlan;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "room_id")
    private Room room;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "electrical_symbol_id", nullable = false)
    private ElectricalSymbol electricalSymbol;

    @Column(name = "position_x", nullable = false, precision = 10, scale = 2)
    private BigDecimal positionX; // позиция X в см

    @Column(name = "position_y", nullable = false, precision = 10, scale = 2)
    private BigDecimal positionY; // позиция Y в см

    @Column(name = "height_from_floor", precision = 5, scale = 2)
    private BigDecimal heightFromFloor; // высота от пола в см

    @Column(name = "rotation", precision = 5, scale = 2)
    @Builder.Default
    private BigDecimal rotation = BigDecimal.ZERO; // угол поворота в градусах

    @Column(name = "group_name", length = 100)
    private String group; // группа для группового управления (например, "освещение_кухня")

    @Column(name = "notes", length = 500)
    private String notes;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\ElectricalSymbol.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "electrical_symbols")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ElectricalSymbol {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true, length = 100)
    private String name;

    @Column(name = "svg_path", length = 2000)
    private String svgPath; // SVG path для отрисовки символа

    @Column(nullable = false, length = 50)
    private String type; // "outlet", "switch", "light", "panel", "junction_box"

    @Column(length = 50)
    private String category; // "power", "lighting", "control", "distribution"

    @Column(name = "default_width")
    @Builder.Default
    private Double defaultWidth = 20.0; // ширина по умолчанию в пикселях

    @Column(name = "default_height")
    @Builder.Default
    private Double defaultHeight = 20.0; // высота по умолчанию в пикселях

    @Column(nullable = false)
    @Builder.Default
    private Boolean active = true;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\FloorPlan.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.util.List;

@Entity
@Table(name = "floor_plans")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class FloorPlan {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "project_id", nullable = false, unique = true)
    private Project project;

    @Column(nullable = false, precision = 10, scale = 2)
    @Builder.Default
    private BigDecimal width = BigDecimal.valueOf(1000); // в см

    @Column(nullable = false, precision = 10, scale = 2)
    @Builder.Default
    private BigDecimal height = BigDecimal.valueOf(800); // в см

    @Column(nullable = false, precision = 5, scale = 2)
    @Builder.Default
    private BigDecimal scale = BigDecimal.valueOf(1.0); // масштаб (1 см = N пикселей)

    @OneToMany(mappedBy = "floorPlan", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Wall> walls;

    @OneToMany(mappedBy = "floorPlan", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ElectricalPoint> electricalPoints;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\PlacementRule.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Entity
@Table(name = "placement_rules")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class PlacementRule {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 50)
    private String type; // "outlet", "switch", "light"

    @Column(length = 1000)
    private String description;

    @Column(name = "min_distance_from_floor", precision = 5, scale = 2)
    private BigDecimal minDistanceFromFloor; // минимальное расстояние от пола в см

    @Column(name = "max_distance_from_floor", precision = 5, scale = 2)
    private BigDecimal maxDistanceFromFloor; // максимальное расстояние от пола в см

    @Column(name = "recommended_height", precision = 5, scale = 2)
    private BigDecimal recommendedHeight; // рекомендуемая высота в см

    @Column(name = "min_distance_from_door", precision = 5, scale = 2)
    private BigDecimal minDistanceFromDoor; // минимальное расстояние от двери в см

    @Column(name = "min_distance_between", precision = 5, scale = 2)
    private BigDecimal minDistanceBetween; // минимальное расстояние между элементами в см

    @Column(nullable = false)
    @Builder.Default
    private Boolean active = true;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\Project.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.List;

@Entity
@Table(name = "projects")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Project {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 100)
    private String name;

    @Column(length = 1000)
    private String description;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "designer_id", nullable = false)
    private User designer;

    @OneToMany(mappedBy = "project", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Room> rooms;

    @OneToMany(mappedBy = "project", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ProjectAppliance> projectAppliances;

    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @Column(name = "updated_at")
    private LocalDateTime updatedAt;

    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
        updatedAt = LocalDateTime.now();
    }

    @PreUpdate
    protected void onUpdate() {
        updatedAt = LocalDateTime.now();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\ProjectAppliance.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Entity
@Table(name = "project_appliances")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ProjectAppliance {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "project_id", nullable = false)
    private Project project;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "appliance_id", nullable = false)
    private Appliance appliance;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "room_id")
    private Room room;

    @Column(name = "quantity", nullable = false)
    @Builder.Default
    private Integer quantity = 1;

    @Column(name = "total_power", precision = 10, scale = 2)
    private BigDecimal totalPower;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\Role.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "roles")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Role {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false, unique = true, length = 20)
    private RoleName name;

    public enum RoleName {
        GUEST,
        DESIGNER,
        ADMIN
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\Room.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.util.List;

@Entity
@Table(name = "rooms")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Room {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 100)
    private String name;

    @Column(name = "area", precision = 10, scale = 2)
    private BigDecimal area;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "room_type_id", nullable = false)
    private RoomType roomType;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "project_id", nullable = false)
    private Project project;

    @Column(length = 500)
    private String description;

    // Координаты для визуального отображения (полигон или прямоугольник)
    @Column(name = "position_x", precision = 10, scale = 2)
    private BigDecimal positionX; // X координата верхнего левого угла в см

    @Column(name = "position_y", precision = 10, scale = 2)
    private BigDecimal positionY; // Y координата верхнего левого угла в см

    @Column(name = "width", precision = 10, scale = 2)
    private BigDecimal width; // ширина в см

    @Column(name = "height", precision = 10, scale = 2)
    private BigDecimal height; // высота в см

    @Column(name = "polygon_points", length = 2000)
    private String polygonPoints; // JSON массив точек для полигона: [{"x": 100, "y": 200}, ...]

    @OneToMany(mappedBy = "room", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ElectricalPoint> electricalPoints;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\RoomType.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(name = "room_types")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class RoomType {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true, length = 100)
    private String name;

    @Column(length = 500)
    private String description;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\User.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import java.time.LocalDateTime;
import java.util.Collection;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

@Entity
@Table(name = "users")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User implements UserDetails {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true, length = 50)
    private String username;

    @Column(nullable = false, unique = true, length = 100)
    private String email;

    @Column(nullable = false)
    private String password;

    @Column(name = "first_name", length = 50)
    private String firstName;

    @Column(name = "last_name", length = 50)
    private String lastName;

    @Column(name = "photo_url", length = 500)
    private String photoUrl;

    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
            name = "user_roles",
            joinColumns = @JoinColumn(name = "user_id"),
            inverseJoinColumns = @JoinColumn(name = "role_id")
    )
    private Set<Role> roles;

    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @Column(name = "updated_at")
    private LocalDateTime updatedAt;

    @Column(nullable = false)
    @Builder.Default
    private Boolean enabled = true;

    @OneToMany(mappedBy = "designer", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Project> projects;

    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
        updatedAt = LocalDateTime.now();
    }

    @PreUpdate
    protected void onUpdate() {
        updatedAt = LocalDateTime.now();
    }

    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        return roles.stream()
                .map(role -> new SimpleGrantedAuthority("ROLE_" + role.getName().name()))
                .collect(Collectors.toList());
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return enabled;
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\Wall.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.util.List;

@Entity
@Table(name = "walls")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Wall {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "floor_plan_id", nullable = false)
    private FloorPlan floorPlan;

    @Column(name = "start_x", nullable = false, precision = 10, scale = 2)
    private BigDecimal startX;

    @Column(name = "start_y", nullable = false, precision = 10, scale = 2)
    private BigDecimal startY;

    @Column(name = "end_x", nullable = false, precision = 10, scale = 2)
    private BigDecimal endX;

    @Column(name = "end_y", nullable = false, precision = 10, scale = 2)
    private BigDecimal endY;

    @Column(name = "thickness", precision = 5, scale = 2)
    @Builder.Default
    private BigDecimal thickness = BigDecimal.valueOf(20); // толщина стены в см

    @Column(name = "wall_type", length = 50)
    private String wallType; // "external", "internal", "load_bearing"

    @OneToMany(mappedBy = "wall", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<WallOpening> openings;
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\model\WallOpening.java] 
 
package com.verchuk.electro.model;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Entity
@Table(name = "wall_openings")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class WallOpening {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "wall_id", nullable = false)
    private Wall wall;

    @Column(name = "position", precision = 10, scale = 2, nullable = false)
    private BigDecimal position; // позиция от начала стены в см

    @Column(name = "width", precision = 10, scale = 2, nullable = false)
    private BigDecimal width; // ширина проема в см

    @Column(name = "height", precision = 10, scale = 2)
    private BigDecimal height; // высота проема в см

    @Column(name = "opening_type", length = 50)
    private String openingType; // "door", "window", "arch"
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\ApplianceRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.Appliance;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ApplianceRepository extends JpaRepository<Appliance, Long> {
    List<Appliance> findByActiveTrue();
    
    @Query("SELECT a FROM Appliance a WHERE a.active = true ORDER BY a.name")
    List<Appliance> findAllActiveOrderedByName();
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\ElectricalPointRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.ElectricalPoint;
import com.verchuk.electro.model.FloorPlan;
import com.verchuk.electro.model.Room;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ElectricalPointRepository extends JpaRepository<ElectricalPoint, Long> {
    List<ElectricalPoint> findByFloorPlan(FloorPlan floorPlan);
    List<ElectricalPoint> findByFloorPlanId(Long floorPlanId);
    List<ElectricalPoint> findByRoom(Room room);
    void deleteByFloorPlanId(Long floorPlanId);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\ElectricalSymbolRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.ElectricalSymbol;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
public interface ElectricalSymbolRepository extends JpaRepository<ElectricalSymbol, Long> {
    List<ElectricalSymbol> findByActiveTrue();
    List<ElectricalSymbol> findByType(String type);
    List<ElectricalSymbol> findByCategory(String category);
    Optional<ElectricalSymbol> findByName(String name);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\FloorPlanRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.FloorPlan;
import com.verchuk.electro.model.Project;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface FloorPlanRepository extends JpaRepository<FloorPlan, Long> {
    Optional<FloorPlan> findByProject(Project project);
    Optional<FloorPlan> findByProjectId(Long projectId);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\PlacementRuleRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.PlacementRule;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
public interface PlacementRuleRepository extends JpaRepository<PlacementRule, Long> {
    List<PlacementRule> findByActiveTrue();
    Optional<PlacementRule> findByType(String type);
    List<PlacementRule> findByTypeAndActiveTrue(String type);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\ProjectApplianceRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.ProjectAppliance;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ProjectApplianceRepository extends JpaRepository<ProjectAppliance, Long> {
    List<ProjectAppliance> findByProject(Project project);
    
    @Query("SELECT pa FROM ProjectAppliance pa WHERE pa.project.id = :projectId")
    List<ProjectAppliance> findByProjectId(@Param("projectId") Long projectId);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\ProjectRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
public interface ProjectRepository extends JpaRepository<Project, Long> {
    List<Project> findByDesigner(User designer);
    Optional<Project> findByIdAndDesigner(Long id, User designer);
    
    @Query("SELECT DISTINCT p FROM Project p LEFT JOIN FETCH p.rooms WHERE p.id = :id")
    Optional<Project> findByIdWithRooms(@Param("id") Long id);
    
    @Query("SELECT DISTINCT p FROM Project p LEFT JOIN FETCH p.projectAppliances WHERE p.id = :id")
    Optional<Project> findByIdWithAppliances(@Param("id") Long id);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\RoleRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.Role;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface RoleRepository extends JpaRepository<Role, Long> {
    Optional<Role> findByName(Role.RoleName name);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\RoomRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.Room;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
public interface RoomRepository extends JpaRepository<Room, Long> {
    List<Room> findByProject(Project project);
    Optional<Room> findByIdAndProject(Long id, Project project);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\RoomTypeRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.RoomType;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface RoomTypeRepository extends JpaRepository<RoomType, Long> {
    Optional<RoomType> findByName(String name);
    boolean existsByName(String name);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\UserRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByUsername(String username);
    Optional<User> findByEmail(String email);
    boolean existsByUsername(String username);
    boolean existsByEmail(String email);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\repository\WallRepository.java] 
 
package com.verchuk.electro.repository;

import com.verchuk.electro.model.FloorPlan;
import com.verchuk.electro.model.Wall;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface WallRepository extends JpaRepository<Wall, Long> {
    List<Wall> findByFloorPlan(FloorPlan floorPlan);
    List<Wall> findByFloorPlanId(Long floorPlanId);
    void deleteByFloorPlanId(Long floorPlanId);
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\security\AuthEntryPointJwt.java] 
 
package com.verchuk.electro.security;

import com.fasterxml.jackson.databind.ObjectMapper;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.MediaType;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.web.AuthenticationEntryPoint;
import org.springframework.stereotype.Component;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@Component
public class AuthEntryPointJwt implements AuthenticationEntryPoint {

    private static final Logger logger = LoggerFactory.getLogger(AuthEntryPointJwt.class);

    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)
            throws IOException, ServletException {

        // Логируем метод и путь, который вызвал ошибку
        logger.error("Unauthorized error on [{} {}]: {}", request.getMethod(), request.getRequestURI(), authException.getMessage());

        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);

        final Map<String, Object> body = new HashMap<>();
        body.put("status", HttpServletResponse.SC_UNAUTHORIZED);
        body.put("error", "Unauthorized");
        body.put("message", authException.getMessage());
        body.put("path", request.getServletPath());

        final ObjectMapper mapper = new ObjectMapper();
        mapper.writeValue(response.getOutputStream(), body);
    }
} 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\security\JwtAuthenticationFilter.java] 
 
package com.verchuk.electro.security;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.util.StringUtils;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;

@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    @Autowired
    private JwtUtils jwtUtils;

    @Autowired
    private UserDetailsService userDetailsService;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
        try {
            String jwt = parseJwt(request);
            if (jwt != null && jwtUtils.validateToken(jwt, userDetailsService.loadUserByUsername(jwtUtils.extractUsername(jwt)))) {
                String username = jwtUtils.extractUsername(jwt);
                UserDetails userDetails = userDetailsService.loadUserByUsername(username);
                UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(
                        userDetails, null, userDetails.getAuthorities());
                authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                SecurityContextHolder.getContext().setAuthentication(authentication);
            }
        } catch (Exception e) {
            logger.error("Cannot set user authentication: {}", e);
        }
        filterChain.doFilter(request, response);
    }

    private String parseJwt(HttpServletRequest request) {
        String headerAuth = request.getHeader("Authorization");
        if (StringUtils.hasText(headerAuth) && headerAuth.startsWith("Bearer ")) {
            return headerAuth.substring(7);
        }
        return null;
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\security\JwtUtils.java] 
 
package com.verchuk.electro.security;

import io.jsonwebtoken.*;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.nio.charset.StandardCharsets;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Function;

@Component
public class JwtUtils {
    @Value("${jwt.secret}")
    private String secret;

    @Value("${jwt.expiration}")
    private Long expiration;

    private SecretKey getSigningKey() {
        return Keys.hmacShaKeyFor(secret.getBytes(StandardCharsets.UTF_8));
    }

    public String extractUsername(String token) {
        return extractClaim(token, Claims::getSubject);
    }

    public Date extractExpiration(String token) {
        return extractClaim(token, Claims::getExpiration);
    }

    public <T> T extractClaim(String token, Function<Claims, T> claimsResolver) {
        final Claims claims = extractAllClaims(token);
        return claimsResolver.apply(claims);
    }

    private Claims extractAllClaims(String token) {
        return Jwts.parser()
                .verifyWith(getSigningKey())
                .build()
                .parseSignedClaims(token)
                .getPayload();
    }

    private Boolean isTokenExpired(String token) {
        return extractExpiration(token).before(new Date());
    }

    public String generateToken(UserDetails userDetails) {
        Map<String, Object> claims = new HashMap<>();
        return createToken(claims, userDetails.getUsername());
    }

    private String createToken(Map<String, Object> claims, String subject) {
        return Jwts.builder()
                .claims(claims)
                .subject(subject)
                .issuedAt(new Date(System.currentTimeMillis()))
                .expiration(new Date(System.currentTimeMillis() + expiration))
                .signWith(getSigningKey())
                .compact();
    }

    public Boolean validateToken(String token, UserDetails userDetails) {
        final String username = extractUsername(token);
        return (username.equals(userDetails.getUsername()) && !isTokenExpired(token));
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\security\SecurityConfig.java] 
 
package com.verchuk.electro.security;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.Arrays;
import java.util.List;

@Configuration
@EnableWebSecurity
@EnableMethodSecurity
public class SecurityConfig {
    @Autowired
    private UserDetailsService userDetailsService;

    @Autowired
    private JwtAuthenticationFilter jwtAuthenticationFilter;

    @Autowired
    private AuthEntryPointJwt unauthorizedHandler;

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public DaoAuthenticationProvider authenticationProvider() {
        DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();
        authProvider.setUserDetailsService(userDetailsService);
        authProvider.setPasswordEncoder(passwordEncoder());
        return authProvider;
    }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {
        return authConfig.getAuthenticationManager();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.cors(cors -> cors.configurationSource(corsConfigurationSource()))
                .csrf(csrf -> csrf.disable())
                .exceptionHandling(exception -> exception.authenticationEntryPoint(unauthorizedHandler))
                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers(HttpMethod.OPTIONS, "/**").permitAll()
                        .requestMatchers("/error").permitAll()
                        .requestMatchers("/api/auth/**").permitAll()
                        .requestMatchers("/h2-console/**").permitAll()

                        // Админка
                        .requestMatchers("/api/admin/**").hasRole("ADMIN")

                        // Файлы (доступ для авторизованных)
                        .requestMatchers("/api/files/**").permitAll()

                        // Общие ресурсы для авторизованных (включая Дизайнеров)
                        .requestMatchers("/api/room-types/**").authenticated()
                        .requestMatchers("/api/appliances/**").authenticated()
                        .requestMatchers("/api/electrical-symbols/**").authenticated()
                        .requestMatchers("/api/user/**").authenticated()

                        // Дизайнер
                        .requestMatchers("/api/designer/**").hasAnyRole("DESIGNER", "ADMIN")

                        .anyRequest().authenticated()
                );

        http.authenticationProvider(authenticationProvider());
        http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);

        // Настройка для H2 Console (если используется)
        http.headers(headers -> headers.frameOptions(frame -> frame.sameOrigin()));

        return http.build();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(List.of("http://localhost:3000")); // Укажи порт своего фронтенда
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"));
        configuration.setAllowedHeaders(Arrays.asList("Authorization", "Content-Type", "Cache-Control"));
        configuration.setExposedHeaders(List.of("Authorization"));
        configuration.setAllowCredentials(true);
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        return source;
    }
} 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\security\UserDetailsServiceImpl.java] 
 
package com.verchuk.electro.security;

import com.verchuk.electro.model.User;
import com.verchuk.electro.repository.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
public class UserDetailsServiceImpl implements UserDetailsService {
    @Autowired
    private UserRepository userRepository;

    @Override
    @Transactional
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("User Not Found with username: " + username));
        return user;
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\ApplianceService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.ApplianceRequest;
import com.verchuk.electro.dto.response.ApplianceResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.Appliance;
import com.verchuk.electro.repository.ApplianceRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
public class ApplianceService {
    @Autowired
    private ApplianceRepository applianceRepository;

    public List<ApplianceResponse> getAllActiveAppliances() {
        return applianceRepository.findAllActiveOrderedByName().stream()
                .map(this::mapToApplianceResponse)
                .collect(Collectors.toList());
    }

    public ApplianceResponse getApplianceById(Long id) {
        Appliance appliance = applianceRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Appliance", "id", id));
        return mapToApplianceResponse(appliance);
    }

    @Transactional
    public ApplianceResponse createAppliance(ApplianceRequest request) {
        Appliance appliance = Appliance.builder()
                .name(request.getName())
                .description(request.getDescription())
                .powerConsumption(request.getPowerConsumption())
                .voltage(request.getVoltage())
                .current(request.getCurrent())
                .category(request.getCategory())
                .imageUrl(request.getImageUrl())
                .active(true)
                .build();

        return mapToApplianceResponse(applianceRepository.save(appliance));
    }

    @Transactional
    public ApplianceResponse updateAppliance(Long id, ApplianceRequest request) {
        Appliance appliance = applianceRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Appliance", "id", id));

        appliance.setName(request.getName());
        appliance.setDescription(request.getDescription());
        appliance.setPowerConsumption(request.getPowerConsumption());
        appliance.setVoltage(request.getVoltage());
        appliance.setCurrent(request.getCurrent());
        appliance.setCategory(request.getCategory());
        if (request.getImageUrl() != null) {
            appliance.setImageUrl(request.getImageUrl());
        }

        return mapToApplianceResponse(applianceRepository.save(appliance));
    }

    @Transactional
    public void deleteAppliance(Long id) {
        Appliance appliance = applianceRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Appliance", "id", id));
        appliance.setActive(false);
        applianceRepository.save(appliance);
    }

    private ApplianceResponse mapToApplianceResponse(Appliance appliance) {
        return ApplianceResponse.builder()
                .id(appliance.getId())
                .name(appliance.getName())
                .description(appliance.getDescription())
                .powerConsumption(appliance.getPowerConsumption())
                .voltage(appliance.getVoltage())
                .current(appliance.getCurrent())
                .category(appliance.getCategory())
                .imageUrl(appliance.getImageUrl())
                .active(appliance.getActive())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\AuthService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.LoginRequest;
import com.verchuk.electro.dto.request.RegisterRequest;
import com.verchuk.electro.dto.response.JwtResponse;
import com.verchuk.electro.exception.BadRequestException;
import com.verchuk.electro.model.Role;
import com.verchuk.electro.model.User;
import com.verchuk.electro.repository.RoleRepository;
import com.verchuk.electro.repository.UserRepository;
import com.verchuk.electro.security.JwtUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

@Service
public class AuthService {
    @Autowired
    private UserRepository userRepository;

    @Autowired
    private RoleRepository roleRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private JwtUtils jwtUtils;

    @Autowired
    private AuthenticationManager authenticationManager;

    @Transactional
    public JwtResponse register(RegisterRequest request) {
        if (userRepository.existsByUsername(request.getUsername())) {
            throw new BadRequestException("Username is already taken!");
        }
        if (userRepository.existsByEmail(request.getEmail())) {
            throw new BadRequestException("Email is already in use!");
        }

        User user = User.builder()
                .username(request.getUsername())
                .email(request.getEmail())
                .password(passwordEncoder.encode(request.getPassword()))
                .firstName(request.getFirstName())
                .lastName(request.getLastName())
                .enabled(true)
                .build();

        Set<Role> roles = new HashSet<>();
        Role designerRole = roleRepository.findByName(Role.RoleName.DESIGNER)
                .orElseThrow(() -> new BadRequestException("Designer role not found"));
        roles.add(designerRole);
        user.setRoles(roles);

        userRepository.save(user);

        String jwt = jwtUtils.generateToken(user);
        List<String> roleNames = user.getRoles().stream()
                .map(role -> role.getName().name())
                .collect(Collectors.toList());

        return new JwtResponse(jwt, "Bearer", user.getId(), user.getUsername(), user.getEmail(), roleNames);
    }

    public JwtResponse login(LoginRequest request) {
        Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(request.getUsername(), request.getPassword()));

        SecurityContextHolder.getContext().setAuthentication(authentication);
        User user = (User) authentication.getPrincipal();
        String jwt = jwtUtils.generateToken(user);

        List<String> roleNames = user.getRoles().stream()
                .map(role -> role.getName().name())
                .collect(Collectors.toList());

        return new JwtResponse(jwt, "Bearer", user.getId(), user.getUsername(), user.getEmail(), roleNames);
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\CalculationService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.response.ApplianceSummaryResponse;
import com.verchuk.electro.dto.response.CalculationReportResponse;
import com.verchuk.electro.dto.response.RoomCalculationResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.ProjectAppliance;
import com.verchuk.electro.repository.ProjectRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.math.BigDecimal;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

@Service
public class CalculationService {
    @Autowired
    private ProjectRepository projectRepository;

    @Autowired
    private UserService userService;

    public CalculationReportResponse getCalculationReport(Long projectId) {
        var designer = userService.getCurrentUser();
        Project project = projectRepository.findByIdAndDesigner(projectId, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", projectId));

        List<ProjectAppliance> projectAppliances = project.getProjectAppliances();
        if (projectAppliances == null || projectAppliances.isEmpty()) {
            return CalculationReportResponse.builder()
                    .projectId(project.getId())
                    .projectName(project.getName())
                    .totalPowerConsumption(BigDecimal.ZERO)
                    .totalCurrent(BigDecimal.ZERO)
                    .totalAppliances(0)
                    .roomCalculations(List.of())
                    .applianceSummaries(List.of())
                    .build();
        }

        BigDecimal totalPower = projectAppliances.stream()
                .map(pa -> pa.getTotalPower() != null ? pa.getTotalPower() : BigDecimal.ZERO)
                .reduce(BigDecimal.ZERO, BigDecimal::add);

        BigDecimal totalCurrent = projectAppliances.stream()
                .map(pa -> {
                    if (pa.getAppliance().getCurrent() != null && pa.getQuantity() != null) {
                        return pa.getAppliance().getCurrent().multiply(BigDecimal.valueOf(pa.getQuantity()));
                    }
                    return BigDecimal.ZERO;
                })
                .reduce(BigDecimal.ZERO, BigDecimal::add);

        Map<Long, List<ProjectAppliance>> appliancesByRoom = projectAppliances.stream()
                .filter(pa -> pa.getRoom() != null)
                .collect(Collectors.groupingBy(pa -> pa.getRoom().getId()));

        List<RoomCalculationResponse> roomCalculations = appliancesByRoom.entrySet().stream()
                .map(entry -> {
                    var room = entry.getValue().get(0).getRoom();
                    BigDecimal roomPower = entry.getValue().stream()
                            .map(pa -> pa.getTotalPower() != null ? pa.getTotalPower() : BigDecimal.ZERO)
                            .reduce(BigDecimal.ZERO, BigDecimal::add);
                    int applianceCount = entry.getValue().stream()
                            .mapToInt(pa -> pa.getQuantity() != null ? pa.getQuantity() : 0)
                            .sum();

                    return RoomCalculationResponse.builder()
                            .roomId(room.getId())
                            .roomName(room.getName())
                            .totalPower(roomPower)
                            .applianceCount(applianceCount)
                            .build();
                })
                .collect(Collectors.toList());

        Map<Long, List<ProjectAppliance>> appliancesByAppliance = projectAppliances.stream()
                .collect(Collectors.groupingBy(pa -> pa.getAppliance().getId()));

        List<ApplianceSummaryResponse> applianceSummaries = appliancesByAppliance.entrySet().stream()
                .map(entry -> {
                    var appliance = entry.getValue().get(0).getAppliance();
                    int totalQuantity = entry.getValue().stream()
                            .mapToInt(pa -> pa.getQuantity() != null ? pa.getQuantity() : 0)
                            .sum();
                    BigDecimal totalPowerForAppliance = entry.getValue().stream()
                            .map(pa -> pa.getTotalPower() != null ? pa.getTotalPower() : BigDecimal.ZERO)
                            .reduce(BigDecimal.ZERO, BigDecimal::add);

                    return ApplianceSummaryResponse.builder()
                            .applianceId(appliance.getId())
                            .applianceName(appliance.getName())
                            .totalQuantity(totalQuantity)
                            .totalPower(totalPowerForAppliance)
                            .build();
                })
                .collect(Collectors.toList());

        return CalculationReportResponse.builder()
                .projectId(project.getId())
                .projectName(project.getName())
                .totalPowerConsumption(totalPower)
                .totalCurrent(totalCurrent)
                .totalAppliances(projectAppliances.size())
                .roomCalculations(roomCalculations)
                .applianceSummaries(applianceSummaries)
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\ElectricalPointService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.ElectricalPointRequest;
import com.verchuk.electro.dto.response.ElectricalPointResponse;
import com.verchuk.electro.dto.response.ElectricalSymbolResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.ElectricalPoint;
import com.verchuk.electro.model.ElectricalSymbol;
import com.verchuk.electro.model.FloorPlan;
import com.verchuk.electro.model.Room;
import com.verchuk.electro.repository.ElectricalPointRepository;
import com.verchuk.electro.repository.ElectricalSymbolRepository;
import com.verchuk.electro.repository.FloorPlanRepository;
import com.verchuk.electro.repository.RoomRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class ElectricalPointService {
    @Autowired
    private ElectricalPointRepository electricalPointRepository;

    @Autowired
    private FloorPlanRepository floorPlanRepository;

    @Autowired
    private ElectricalSymbolRepository electricalSymbolRepository;

    @Autowired
    private RoomRepository roomRepository;

    @Autowired
    private UserService userService;

    @Transactional
    public ElectricalPointResponse createElectricalPoint(Long projectId, ElectricalPointRequest request) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);
        ElectricalSymbol symbol = electricalSymbolRepository.findById(request.getElectricalSymbolId())
                .orElseThrow(() -> new ResourceNotFoundException("ElectricalSymbol", "id", request.getElectricalSymbolId()));

        Room room = null;
        if (request.getRoomId() != null) {
            room = roomRepository.findById(request.getRoomId())
                    .orElseThrow(() -> new ResourceNotFoundException("Room", "id", request.getRoomId()));
        }

        ElectricalPoint point = ElectricalPoint.builder()
                .floorPlan(floorPlan)
                .room(room)
                .electricalSymbol(symbol)
                .positionX(request.getPositionX())
                .positionY(request.getPositionY())
                .heightFromFloor(request.getHeightFromFloor())
                .rotation(request.getRotation() != null ? request.getRotation() : BigDecimal.ZERO)
                .group(request.getGroup())
                .notes(request.getNotes())
                .build();

        point = electricalPointRepository.save(point);
        return mapToResponse(point);
    }

    @Transactional
    public ElectricalPointResponse updateElectricalPoint(Long projectId, Long pointId, ElectricalPointRequest request) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);
        ElectricalPoint point = electricalPointRepository.findById(pointId)
                .orElseThrow(() -> new ResourceNotFoundException("ElectricalPoint", "id", pointId));

        if (!point.getFloorPlan().getId().equals(floorPlan.getId())) {
            throw new ResourceNotFoundException("ElectricalPoint", "id", pointId);
        }

        if (request.getElectricalSymbolId() != null) {
            ElectricalSymbol symbol = electricalSymbolRepository.findById(request.getElectricalSymbolId())
                    .orElseThrow(() -> new ResourceNotFoundException("ElectricalSymbol", "id", request.getElectricalSymbolId()));
            point.setElectricalSymbol(symbol);
        }

        if (request.getRoomId() != null) {
            Room room = roomRepository.findById(request.getRoomId())
                    .orElseThrow(() -> new ResourceNotFoundException("Room", "id", request.getRoomId()));
            point.setRoom(room);
        } else {
            point.setRoom(null);
        }

        if (request.getPositionX() != null) {
            point.setPositionX(request.getPositionX());
        }
        if (request.getPositionY() != null) {
            point.setPositionY(request.getPositionY());
        }
        if (request.getHeightFromFloor() != null) {
            point.setHeightFromFloor(request.getHeightFromFloor());
        }
        if (request.getRotation() != null) {
            point.setRotation(request.getRotation());
        }
        if (request.getGroup() != null) {
            point.setGroup(request.getGroup());
        }
        if (request.getNotes() != null) {
            point.setNotes(request.getNotes());
        }

        point = electricalPointRepository.save(point);
        return mapToResponse(point);
    }

    @Transactional
    public void deleteElectricalPoint(Long projectId, Long pointId) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);
        ElectricalPoint point = electricalPointRepository.findById(pointId)
                .orElseThrow(() -> new ResourceNotFoundException("ElectricalPoint", "id", pointId));

        if (!point.getFloorPlan().getId().equals(floorPlan.getId())) {
            throw new ResourceNotFoundException("ElectricalPoint", "id", pointId);
        }

        electricalPointRepository.delete(point);
    }

    public List<ElectricalPointResponse> getElectricalPointsByFloorPlan(Long floorPlanId) {
        List<ElectricalPoint> points = electricalPointRepository.findByFloorPlanId(floorPlanId);
        return points.stream()
                .map(this::mapToResponse)
                .collect(Collectors.toList());
    }

    @Transactional
    public List<ElectricalPointResponse> saveElectricalPoints(Long projectId, List<ElectricalPointRequest> requests) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);
        
        // Удаляем старые точки
        electricalPointRepository.deleteByFloorPlanId(floorPlan.getId());

        // Создаем новые точки
        List<ElectricalPoint> points = requests.stream()
                .map(request -> {
                    ElectricalSymbol symbol = electricalSymbolRepository.findById(request.getElectricalSymbolId())
                            .orElseThrow(() -> new ResourceNotFoundException("ElectricalSymbol", "id", request.getElectricalSymbolId()));

                    Room room = null;
                    if (request.getRoomId() != null) {
                        room = roomRepository.findById(request.getRoomId())
                                .orElse(null);
                    }

                    return ElectricalPoint.builder()
                            .floorPlan(floorPlan)
                            .room(room)
                            .electricalSymbol(symbol)
                            .positionX(request.getPositionX())
                            .positionY(request.getPositionY())
                            .heightFromFloor(request.getHeightFromFloor())
                            .rotation(request.getRotation() != null ? request.getRotation() : BigDecimal.ZERO)
                            .group(request.getGroup())
                            .notes(request.getNotes())
                            .build();
                })
                .collect(Collectors.toList());

        points = electricalPointRepository.saveAll(points);
        return points.stream()
                .map(this::mapToResponse)
                .collect(Collectors.toList());
    }

    public FloorPlan getFloorPlanForProject(Long projectId) {
        return floorPlanRepository.findByProjectId(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("FloorPlan", "projectId", projectId));
    }

    private ElectricalPointResponse mapToResponse(ElectricalPoint point) {
        ElectricalSymbolResponse symbolResponse = ElectricalSymbolResponse.builder()
                .id(point.getElectricalSymbol().getId())
                .name(point.getElectricalSymbol().getName())
                .svgPath(point.getElectricalSymbol().getSvgPath())
                .type(point.getElectricalSymbol().getType())
                .category(point.getElectricalSymbol().getCategory())
                .defaultWidth(point.getElectricalSymbol().getDefaultWidth())
                .defaultHeight(point.getElectricalSymbol().getDefaultHeight())
                .active(point.getElectricalSymbol().getActive())
                .build();

        return ElectricalPointResponse.builder()
                .id(point.getId())
                .roomId(point.getRoom() != null ? point.getRoom().getId() : null)
                .roomName(point.getRoom() != null ? point.getRoom().getName() : null)
                .electricalSymbol(symbolResponse)
                .positionX(point.getPositionX())
                .positionY(point.getPositionY())
                .heightFromFloor(point.getHeightFromFloor())
                .rotation(point.getRotation())
                .group(point.getGroup())
                .notes(point.getNotes())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\ElectricalSymbolService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.ElectricalSymbolRequest;
import com.verchuk.electro.dto.response.ElectricalSymbolResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.ElectricalSymbol;
import com.verchuk.electro.repository.ElectricalSymbolRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
public class ElectricalSymbolService {
    @Autowired
    private ElectricalSymbolRepository electricalSymbolRepository;

    public List<ElectricalSymbolResponse> getAllSymbols() {
        List<ElectricalSymbol> symbols = electricalSymbolRepository.findByActiveTrue();
        return symbols.stream()
                .map(this::mapToResponse)
                .collect(Collectors.toList());
    }

    public List<ElectricalSymbolResponse> getSymbolsByType(String type) {
        List<ElectricalSymbol> symbols = electricalSymbolRepository.findByType(type);
        return symbols.stream()
                .map(this::mapToResponse)
                .collect(Collectors.toList());
    }

    public List<ElectricalSymbolResponse> getSymbolsByCategory(String category) {
        List<ElectricalSymbol> symbols = electricalSymbolRepository.findByCategory(category);
        return symbols.stream()
                .map(this::mapToResponse)
                .collect(Collectors.toList());
    }

    public ElectricalSymbolResponse getSymbolById(Long id) {
        ElectricalSymbol symbol = electricalSymbolRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("ElectricalSymbol", "id", id));
        return mapToResponse(symbol);
    }

    @Transactional
    public ElectricalSymbolResponse createSymbol(ElectricalSymbolRequest request) {
        ElectricalSymbol symbol = ElectricalSymbol.builder()
                .name(request.getName())
                .svgPath(request.getSvgPath())
                .type(request.getType())
                .category(request.getCategory())
                .defaultWidth(request.getDefaultWidth() != null ? request.getDefaultWidth() : 20.0)
                .defaultHeight(request.getDefaultHeight() != null ? request.getDefaultHeight() : 20.0)
                .active(request.getActive() != null ? request.getActive() : true)
                .build();

        symbol = electricalSymbolRepository.save(symbol);
        return mapToResponse(symbol);
    }

    @Transactional
    public ElectricalSymbolResponse updateSymbol(Long id, ElectricalSymbolRequest request) {
        ElectricalSymbol symbol = electricalSymbolRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("ElectricalSymbol", "id", id));

        if (request.getName() != null) {
            symbol.setName(request.getName());
        }
        if (request.getSvgPath() != null) {
            symbol.setSvgPath(request.getSvgPath());
        }
        if (request.getType() != null) {
            symbol.setType(request.getType());
        }
        if (request.getCategory() != null) {
            symbol.setCategory(request.getCategory());
        }
        if (request.getDefaultWidth() != null) {
            symbol.setDefaultWidth(request.getDefaultWidth());
        }
        if (request.getDefaultHeight() != null) {
            symbol.setDefaultHeight(request.getDefaultHeight());
        }
        if (request.getActive() != null) {
            symbol.setActive(request.getActive());
        }

        symbol = electricalSymbolRepository.save(symbol);
        return mapToResponse(symbol);
    }

    @Transactional
    public void deleteSymbol(Long id) {
        ElectricalSymbol symbol = electricalSymbolRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("ElectricalSymbol", "id", id));
        electricalSymbolRepository.delete(symbol);
    }

    private ElectricalSymbolResponse mapToResponse(ElectricalSymbol symbol) {
        return ElectricalSymbolResponse.builder()
                .id(symbol.getId())
                .name(symbol.getName())
                .svgPath(symbol.getSvgPath())
                .type(symbol.getType())
                .category(symbol.getCategory())
                .defaultWidth(symbol.getDefaultWidth())
                .defaultHeight(symbol.getDefaultHeight())
                .active(symbol.getActive())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\FileService.java] 
 
package com.verchuk.electro.service;

import org.springframework.core.io.Resource;
import org.springframework.core.io.UrlResource;
import org.springframework.core.io.FileSystemResource;
import org.springframework.stereotype.Service;
import org.springframework.util.StringUtils;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;
import java.net.MalformedURLException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;
import java.util.UUID;

@Service
public class FileService {
    private final Path rootLocation;

    public FileService() {
        // Создаем директорию для хранения файлов (используем абсолютный путь)
        try {
            // Пытаемся использовать системную временную директорию или рабочую директорию
            String workingDir = System.getProperty("user.dir");
            this.rootLocation = Paths.get(workingDir, "uploads").toAbsolutePath().normalize();
            
            Files.createDirectories(rootLocation);
            // Создаем поддиректории
            Files.createDirectories(rootLocation.resolve("profiles"));
            Files.createDirectories(rootLocation.resolve("appliances"));
            Files.createDirectories(rootLocation.resolve("general"));
            
            System.out.println("FileService initialized. Root location: " + rootLocation);
        } catch (IOException e) {
            throw new RuntimeException("Could not initialize storage", e);
        }
    }

    public String saveFile(MultipartFile file, String type) throws IOException {
        if (file.isEmpty()) {
            throw new RuntimeException("File is empty");
        }

        // Генерируем уникальное имя файла
        String originalFilename = StringUtils.cleanPath(file.getOriginalFilename());
        String extension = "";
        int lastDotIndex = originalFilename.lastIndexOf('.');
        if (lastDotIndex > 0) {
            extension = originalFilename.substring(lastDotIndex);
        }
        String filename = UUID.randomUUID().toString() + extension;

        // Определяем директорию по типу
        Path targetDir = rootLocation.resolve(type);
        Files.createDirectories(targetDir);

        // Сохраняем файл
        Path targetFile = targetDir.resolve(filename);
        Files.copy(file.getInputStream(), targetFile, StandardCopyOption.REPLACE_EXISTING);

        // Возвращаем только имя файла (URL будет формироваться в контроллере)
        return filename;
    }

    public Resource loadFile(String filename) throws IOException {
        // Ищем файл во всех поддиректориях
        Path[] searchDirs = {
            rootLocation.resolve("profiles"),
            rootLocation.resolve("appliances"),
            rootLocation.resolve("general")
        };

        for (Path dir : searchDirs) {
            Path file = dir.resolve(filename).toAbsolutePath().normalize();
            System.out.println("Trying to load file from: " + file);
            if (Files.exists(file) && Files.isReadable(file)) {
                // Используем FileSystemResource для более надежной работы с локальными файлами
                try {
                    Resource resource = new FileSystemResource(file.toFile());
                    if (resource.exists() && resource.isReadable()) {
                        System.out.println("File found and readable: " + file);
                        return resource;
                    } else {
                        System.out.println("File exists but resource is not readable: " + file);
                    }
                } catch (Exception e) {
                    System.out.println("Error creating FileSystemResource: " + e.getMessage());
                    // Попробуем UrlResource как fallback
                    try {
                        Resource resource = new UrlResource(file.toUri());
                        if (resource.exists() && resource.isReadable()) {
                            System.out.println("File loaded using UrlResource (fallback)");
                            return resource;
                        }
                    } catch (Exception e2) {
                        System.out.println("UrlResource fallback also failed: " + e2.getMessage());
                    }
                }
            } else {
                System.out.println("File does not exist or is not readable: " + file);
            }
        }

        throw new IOException("File not found: " + filename + ". Searched in: " + 
            rootLocation.resolve("profiles") + ", " + 
            rootLocation.resolve("appliances") + ", " + 
            rootLocation.resolve("general"));
    }

    public void deleteFile(String filename) throws IOException {
        Path[] searchDirs = {
            rootLocation.resolve("profiles"),
            rootLocation.resolve("appliances"),
            rootLocation.resolve("general")
        };

        for (Path dir : searchDirs) {
            Path file = dir.resolve(filename);
            if (Files.exists(file)) {
                Files.delete(file);
                return;
            }
        }

        throw new IOException("File not found: " + filename);
    }

    public String getContentType(String filename) throws IOException {
        Path[] searchDirs = {
            rootLocation.resolve("profiles"),
            rootLocation.resolve("appliances"),
            rootLocation.resolve("general")
        };

        for (Path dir : searchDirs) {
            Path file = dir.resolve(filename);
            if (Files.exists(file)) {
                return Files.probeContentType(file);
            }
        }

        return "application/octet-stream";
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\FloorPlanService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.FloorPlanRequest;
import com.verchuk.electro.dto.response.FloorPlanResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.FloorPlan;
import com.verchuk.electro.model.Project;
import com.verchuk.electro.repository.FloorPlanRepository;
import com.verchuk.electro.repository.ProjectRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;

@Service
public class FloorPlanService {
    @Autowired
    private FloorPlanRepository floorPlanRepository;

    @Autowired
    private ProjectRepository projectRepository;

    @Autowired
    private UserService userService;

    @Autowired
    private WallService wallService;

    @Autowired
    private ElectricalPointService electricalPointService;

    @Transactional
    public FloorPlanResponse createOrUpdateFloorPlan(Long projectId, FloorPlanRequest request) {
        var designer = userService.getCurrentUser();
        Project project = projectRepository.findByIdAndDesigner(projectId, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", projectId));

        FloorPlan floorPlan = floorPlanRepository.findByProject(project)
                .orElse(FloorPlan.builder()
                        .project(project)
                        .width(request.getWidth() != null ? request.getWidth() : BigDecimal.valueOf(1000))
                        .height(request.getHeight() != null ? request.getHeight() : BigDecimal.valueOf(800))
                        .scale(request.getScale() != null ? request.getScale() : BigDecimal.valueOf(1.0))
                        .build());

        if (request.getWidth() != null) {
            floorPlan.setWidth(request.getWidth());
        }
        if (request.getHeight() != null) {
            floorPlan.setHeight(request.getHeight());
        }
        if (request.getScale() != null) {
            floorPlan.setScale(request.getScale());
        }

        floorPlan = floorPlanRepository.save(floorPlan);
        return mapToResponse(floorPlan);
    }

    public FloorPlanResponse getFloorPlan(Long projectId) {
        var designer = userService.getCurrentUser();
        Project project = projectRepository.findByIdAndDesigner(projectId, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", projectId));

        FloorPlan floorPlan = floorPlanRepository.findByProject(project)
                .orElseThrow(() -> new ResourceNotFoundException("FloorPlan", "projectId", projectId));

        return mapToResponse(floorPlan);
    }

    @Transactional
    public void deleteFloorPlan(Long projectId) {
        var designer = userService.getCurrentUser();
        Project project = projectRepository.findByIdAndDesigner(projectId, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", projectId));

        FloorPlan floorPlan = floorPlanRepository.findByProject(project)
                .orElseThrow(() -> new ResourceNotFoundException("FloorPlan", "projectId", projectId));

        floorPlanRepository.delete(floorPlan);
    }

    private FloorPlanResponse mapToResponse(FloorPlan floorPlan) {
        return FloorPlanResponse.builder()
                .id(floorPlan.getId())
                .projectId(floorPlan.getProject().getId())
                .width(floorPlan.getWidth())
                .height(floorPlan.getHeight())
                .scale(floorPlan.getScale())
                .walls(wallService.getWallsByFloorPlan(floorPlan.getId()))
                .electricalPoints(electricalPointService.getElectricalPointsByFloorPlan(floorPlan.getId()))
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\ProjectApplianceService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.ProjectApplianceRequest;
import com.verchuk.electro.dto.response.ProjectApplianceResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.Appliance;
import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.ProjectAppliance;
import com.verchuk.electro.model.Room;
import com.verchuk.electro.repository.ApplianceRepository;
import com.verchuk.electro.repository.ProjectApplianceRepository;
import com.verchuk.electro.repository.ProjectRepository;
import com.verchuk.electro.repository.RoomRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class ProjectApplianceService {
    @Autowired
    private ProjectApplianceRepository projectApplianceRepository;

    @Autowired
    private ProjectRepository projectRepository;

    @Autowired
    private ApplianceRepository applianceRepository;

    @Autowired
    private RoomRepository roomRepository;

    @Autowired
    private UserService userService;

    public List<ProjectApplianceResponse> getProjectAppliances(Long projectId) {
        Project project = getProjectForCurrentUser(projectId);
        return projectApplianceRepository.findByProject(project).stream()
                .map(this::mapToProjectApplianceResponse)
                .collect(Collectors.toList());
    }

    @Transactional
    public ProjectApplianceResponse addProjectAppliance(Long projectId, ProjectApplianceRequest request) {
        Project project = getProjectForCurrentUser(projectId);
        Appliance appliance = applianceRepository.findById(request.getApplianceId())
                .orElseThrow(() -> new ResourceNotFoundException("Appliance", "id", request.getApplianceId()));

        Room room = null;
        if (request.getRoomId() != null) {
            room = roomRepository.findByIdAndProject(request.getRoomId(), project)
                    .orElseThrow(() -> new ResourceNotFoundException("Room", "id", request.getRoomId()));
        }

        BigDecimal totalPower = appliance.getPowerConsumption().multiply(BigDecimal.valueOf(request.getQuantity()));

        ProjectAppliance projectAppliance = ProjectAppliance.builder()
                .project(project)
                .appliance(appliance)
                .room(room)
                .quantity(request.getQuantity())
                .totalPower(totalPower)
                .build();

        return mapToProjectApplianceResponse(projectApplianceRepository.save(projectAppliance));
    }

    @Transactional
    public ProjectApplianceResponse updateProjectAppliance(Long projectId, Long projectApplianceId, ProjectApplianceRequest request) {
        Project project = getProjectForCurrentUser(projectId);
        ProjectAppliance projectAppliance = projectApplianceRepository.findById(projectApplianceId)
                .orElseThrow(() -> new ResourceNotFoundException("ProjectAppliance", "id", projectApplianceId));

        if (!projectAppliance.getProject().getId().equals(projectId)) {
            throw new ResourceNotFoundException("ProjectAppliance", "id", projectApplianceId);
        }

        Appliance appliance = applianceRepository.findById(request.getApplianceId())
                .orElseThrow(() -> new ResourceNotFoundException("Appliance", "id", request.getApplianceId()));

        Room room = null;
        if (request.getRoomId() != null) {
            room = roomRepository.findByIdAndProject(request.getRoomId(), project)
                    .orElseThrow(() -> new ResourceNotFoundException("Room", "id", request.getRoomId()));
        }

        projectAppliance.setAppliance(appliance);
        projectAppliance.setRoom(room);
        projectAppliance.setQuantity(request.getQuantity());
        projectAppliance.setTotalPower(appliance.getPowerConsumption().multiply(BigDecimal.valueOf(request.getQuantity())));

        return mapToProjectApplianceResponse(projectApplianceRepository.save(projectAppliance));
    }

    @Transactional
    public void deleteProjectAppliance(Long projectId, Long projectApplianceId) {
        Project project = getProjectForCurrentUser(projectId);
        ProjectAppliance projectAppliance = projectApplianceRepository.findById(projectApplianceId)
                .orElseThrow(() -> new ResourceNotFoundException("ProjectAppliance", "id", projectApplianceId));

        if (!projectAppliance.getProject().getId().equals(projectId)) {
            throw new ResourceNotFoundException("ProjectAppliance", "id", projectApplianceId);
        }

        projectApplianceRepository.delete(projectAppliance);
    }

    private Project getProjectForCurrentUser(Long projectId) {
        var designer = userService.getCurrentUser();
        return projectRepository.findByIdAndDesigner(projectId, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", projectId));
    }

    private ProjectApplianceResponse mapToProjectApplianceResponse(ProjectAppliance projectAppliance) {
        return ProjectApplianceResponse.builder()
                .id(projectAppliance.getId())
                .applianceId(projectAppliance.getAppliance().getId())
                .applianceName(projectAppliance.getAppliance().getName())
                .roomId(projectAppliance.getRoom() != null ? projectAppliance.getRoom().getId() : null)
                .roomName(projectAppliance.getRoom() != null ? projectAppliance.getRoom().getName() : null)
                .quantity(projectAppliance.getQuantity())
                .totalPower(projectAppliance.getTotalPower())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\ProjectService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.ProjectRequest;
import com.verchuk.electro.dto.response.ProjectResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.User;
import com.verchuk.electro.repository.ProjectRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
public class ProjectService {
    @Autowired
    private ProjectRepository projectRepository;

    @Autowired
    private UserService userService;

    public List<ProjectResponse> getAllProjectsForCurrentUser() {
        User designer = userService.getCurrentUser();
        return projectRepository.findByDesigner(designer).stream()
                .map(this::mapToProjectResponse)
                .collect(Collectors.toList());
    }

    public List<ProjectResponse> getAllProjects() {
        return projectRepository.findAll().stream()
                .map(this::mapToProjectResponse)
                .collect(Collectors.toList());
    }

    @Transactional(readOnly = true)
    public ProjectResponse getProjectById(Long id) {
        // Загружаем проект с комнатами
        Project project = projectRepository.findByIdWithRooms(id)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", id));
        // Загружаем электроприборы отдельным запросом
        projectRepository.findByIdWithAppliances(id).ifPresent(p -> {
            project.setProjectAppliances(p.getProjectAppliances());
        });
        return mapToProjectResponse(project);
    }

    @Transactional(readOnly = true)
    public ProjectResponse getProjectByIdForCurrentUser(Long id) {
        User designer = userService.getCurrentUser();
        // Проверяем права доступа
        projectRepository.findByIdAndDesigner(id, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", id));
        // Загружаем проект с комнатами
        Project project = projectRepository.findByIdWithRooms(id)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", id));
        // Загружаем электроприборы отдельным запросом
        projectRepository.findByIdWithAppliances(id).ifPresent(p -> {
            project.setProjectAppliances(p.getProjectAppliances());
        });
        return mapToProjectResponse(project);
    }

    @Transactional
    public ProjectResponse createProject(ProjectRequest request) {
        User designer = userService.getCurrentUser();
        Project project = Project.builder()
                .name(request.getName())
                .description(request.getDescription())
                .designer(designer)
                .build();
        return mapToProjectResponse(projectRepository.save(project));
    }

    @Transactional
    public ProjectResponse updateProject(Long id, ProjectRequest request) {
        User designer = userService.getCurrentUser();
        Project project = projectRepository.findByIdAndDesigner(id, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", id));

        project.setName(request.getName());
        project.setDescription(request.getDescription());

        return mapToProjectResponse(projectRepository.save(project));
    }

    @Transactional
    public void deleteProject(Long id) {
        User designer = userService.getCurrentUser();
        Project project = projectRepository.findByIdAndDesigner(id, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", id));
        projectRepository.delete(project);
    }

    private ProjectResponse mapToProjectResponse(Project project) {
        return ProjectResponse.builder()
                .id(project.getId())
                .name(project.getName())
                .description(project.getDescription())
                .designerId(project.getDesigner().getId())
                .designerUsername(project.getDesigner().getUsername())
                .rooms(project.getRooms() != null ? project.getRooms().stream()
                        .map(room -> com.verchuk.electro.dto.response.RoomResponse.builder()
                                .id(room.getId())
                                .name(room.getName())
                                .area(room.getArea())
                                .roomTypeId(room.getRoomType().getId())
                                .roomTypeName(room.getRoomType().getName())
                                .description(room.getDescription())
                                .build())
                        .collect(Collectors.toList()) : List.of())
                .appliances(project.getProjectAppliances() != null ? project.getProjectAppliances().stream()
                        .map(pa -> com.verchuk.electro.dto.response.ProjectApplianceResponse.builder()
                                .id(pa.getId())
                                .applianceId(pa.getAppliance().getId())
                                .applianceName(pa.getAppliance().getName())
                                .roomId(pa.getRoom() != null ? pa.getRoom().getId() : null)
                                .roomName(pa.getRoom() != null ? pa.getRoom().getName() : null)
                                .quantity(pa.getQuantity())
                                .totalPower(pa.getTotalPower())
                                .build())
                        .collect(Collectors.toList()) : List.of())
                .createdAt(project.getCreatedAt())
                .updatedAt(project.getUpdatedAt())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\RoomService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.RoomRequest;
import com.verchuk.electro.dto.response.RoomResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.Room;
import com.verchuk.electro.model.RoomType;
import com.verchuk.electro.repository.ProjectRepository;
import com.verchuk.electro.repository.RoomRepository;
import com.verchuk.electro.repository.RoomTypeRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
public class RoomService {
    @Autowired
    private RoomRepository roomRepository;

    @Autowired
    private ProjectRepository projectRepository;

    @Autowired
    private RoomTypeRepository roomTypeRepository;

    @Autowired
    private UserService userService;

    public List<RoomResponse> getRoomsByProject(Long projectId) {
        Project project = getProjectForCurrentUser(projectId);
        return roomRepository.findByProject(project).stream()
                .map(this::mapToRoomResponse)
                .collect(Collectors.toList());
    }

    public RoomResponse getRoomById(Long projectId, Long roomId) {
        Project project = getProjectForCurrentUser(projectId);
        Room room = roomRepository.findByIdAndProject(roomId, project)
                .orElseThrow(() -> new ResourceNotFoundException("Room", "id", roomId));
        return mapToRoomResponse(room);
    }

    @Transactional
    public RoomResponse createRoom(Long projectId, RoomRequest request) {
        Project project = getProjectForCurrentUser(projectId);
        RoomType roomType = roomTypeRepository.findById(request.getRoomTypeId())
                .orElseThrow(() -> new ResourceNotFoundException("RoomType", "id", request.getRoomTypeId()));

        Room room = Room.builder()
                .name(request.getName())
                .area(request.getArea())
                .roomType(roomType)
                .project(project)
                .description(request.getDescription())
                .positionX(request.getPositionX())
                .positionY(request.getPositionY())
                .width(request.getWidth())
                .height(request.getHeight())
                .polygonPoints(request.getPolygonPoints())
                .build();

        return mapToRoomResponse(roomRepository.save(room));
    }

    @Transactional
    public RoomResponse updateRoom(Long projectId, Long roomId, RoomRequest request) {
        Project project = getProjectForCurrentUser(projectId);
        Room room = roomRepository.findByIdAndProject(roomId, project)
                .orElseThrow(() -> new ResourceNotFoundException("Room", "id", roomId));

        room.setName(request.getName());
        room.setArea(request.getArea());
        room.setDescription(request.getDescription());
        room.setPositionX(request.getPositionX());
        room.setPositionY(request.getPositionY());
        room.setWidth(request.getWidth());
        room.setHeight(request.getHeight());
        room.setPolygonPoints(request.getPolygonPoints());

        if (request.getRoomTypeId() != null && !request.getRoomTypeId().equals(room.getRoomType().getId())) {
            RoomType roomType = roomTypeRepository.findById(request.getRoomTypeId())
                    .orElseThrow(() -> new ResourceNotFoundException("RoomType", "id", request.getRoomTypeId()));
            room.setRoomType(roomType);
        }

        return mapToRoomResponse(roomRepository.save(room));
    }

    @Transactional
    public void deleteRoom(Long projectId, Long roomId) {
        Project project = getProjectForCurrentUser(projectId);
        Room room = roomRepository.findByIdAndProject(roomId, project)
                .orElseThrow(() -> new ResourceNotFoundException("Room", "id", roomId));
        roomRepository.delete(room);
    }

    private Project getProjectForCurrentUser(Long projectId) {
        var designer = userService.getCurrentUser();
        return projectRepository.findByIdAndDesigner(projectId, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", projectId));
    }

    private RoomResponse mapToRoomResponse(Room room) {
        return RoomResponse.builder()
                .id(room.getId())
                .name(room.getName())
                .area(room.getArea())
                .roomTypeId(room.getRoomType().getId())
                .roomTypeName(room.getRoomType().getName())
                .description(room.getDescription())
                .positionX(room.getPositionX())
                .positionY(room.getPositionY())
                .width(room.getWidth())
                .height(room.getHeight())
                .polygonPoints(room.getPolygonPoints())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\RoomTypeService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.RoomTypeRequest;
import com.verchuk.electro.dto.response.RoomTypeResponse;
import com.verchuk.electro.exception.BadRequestException;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.RoomType;
import com.verchuk.electro.repository.RoomTypeRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
public class RoomTypeService {
    @Autowired
    private RoomTypeRepository roomTypeRepository;

    public List<RoomTypeResponse> getAllRoomTypes() {
        return roomTypeRepository.findAll().stream()
                .map(this::mapToRoomTypeResponse)
                .collect(Collectors.toList());
    }

    public RoomTypeResponse getRoomTypeById(Long id) {
        RoomType roomType = roomTypeRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("RoomType", "id", id));
        return mapToRoomTypeResponse(roomType);
    }

    @Transactional
    public RoomTypeResponse createRoomType(RoomTypeRequest request) {
        if (roomTypeRepository.existsByName(request.getName())) {
            throw new BadRequestException("Room type with this name already exists");
        }

        RoomType roomType = RoomType.builder()
                .name(request.getName())
                .description(request.getDescription())
                .build();

        return mapToRoomTypeResponse(roomTypeRepository.save(roomType));
    }

    @Transactional
    public RoomTypeResponse updateRoomType(Long id, RoomTypeRequest request) {
        RoomType roomType = roomTypeRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("RoomType", "id", id));

        if (!roomType.getName().equals(request.getName()) && roomTypeRepository.existsByName(request.getName())) {
            throw new BadRequestException("Room type with this name already exists");
        }

        roomType.setName(request.getName());
        roomType.setDescription(request.getDescription());

        return mapToRoomTypeResponse(roomTypeRepository.save(roomType));
    }

    @Transactional
    public void deleteRoomType(Long id) {
        RoomType roomType = roomTypeRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("RoomType", "id", id));
        roomTypeRepository.delete(roomType);
    }

    private RoomTypeResponse mapToRoomTypeResponse(RoomType roomType) {
        return RoomTypeResponse.builder()
                .id(roomType.getId())
                .name(roomType.getName())
                .description(roomType.getDescription())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\SpecificationService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.response.EquipmentItemResponse;
import com.verchuk.electro.dto.response.SpecificationResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.Project;
import com.verchuk.electro.model.ProjectAppliance;
import com.verchuk.electro.repository.ProjectRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

@Service
public class SpecificationService {
    @Autowired
    private ProjectRepository projectRepository;

    @Autowired
    private UserService userService;

    public SpecificationResponse getSpecification(Long projectId) {
        var designer = userService.getCurrentUser();
        Project project = projectRepository.findByIdAndDesigner(projectId, designer)
                .orElseThrow(() -> new ResourceNotFoundException("Project", "id", projectId));

        List<ProjectAppliance> projectAppliances = project.getProjectAppliances();
        List<EquipmentItemResponse> equipmentItems = new ArrayList<>();

        if (projectAppliances != null && !projectAppliances.isEmpty()) {
            BigDecimal totalPower = projectAppliances.stream()
                    .map(pa -> pa.getTotalPower() != null ? pa.getTotalPower() : BigDecimal.ZERO)
                    .reduce(BigDecimal.ZERO, BigDecimal::add);

            Map<String, List<ProjectAppliance>> byCategory = projectAppliances.stream()
                    .collect(Collectors.groupingBy(pa -> pa.getAppliance().getCategory() != null ?
                            pa.getAppliance().getCategory() : "Other"));

            for (Map.Entry<String, List<ProjectAppliance>> entry : byCategory.entrySet()) {
                String category = entry.getKey();
                List<ProjectAppliance> appliances = entry.getValue();

                for (ProjectAppliance pa : appliances) {
                    equipmentItems.add(EquipmentItemResponse.builder()
                            .category(category)
                            .name(pa.getAppliance().getName())
                            .specification(String.format("Power: %s W, Voltage: %s V, Quantity: %d",
                                    pa.getAppliance().getPowerConsumption(),
                                    pa.getAppliance().getVoltage() != null ? pa.getAppliance().getVoltage() : "N/A",
                                    pa.getQuantity()))
                            .quantity(pa.getQuantity())
                            .notes(pa.getRoom() != null ? "Room: " + pa.getRoom().getName() : null)
                            .build());
                }
            }

            equipmentItems.add(EquipmentItemResponse.builder()
                    .category("Electrical Panel")
                    .name("Main Circuit Breaker")
                    .specification(String.format("Rated current: %.0f A", totalPower.divide(BigDecimal.valueOf(220), 2, RoundingMode.UP)))
                    .quantity(1)
                    .notes("Based on total power consumption")
                    .build());
        }

        String recommendations = generateRecommendations(projectAppliances);

        return SpecificationResponse.builder()
                .projectId(project.getId())
                .projectName(project.getName())
                .equipmentItems(equipmentItems)
                .recommendations(recommendations)
                .build();
    }

    private String generateRecommendations(List<ProjectAppliance> projectAppliances) {
        if (projectAppliances == null || projectAppliances.isEmpty()) {
            return "No appliances in project. Add appliances to generate recommendations.";
        }

        BigDecimal totalPower = projectAppliances.stream()
                .map(pa -> pa.getTotalPower() != null ? pa.getTotalPower() : BigDecimal.ZERO)
                .reduce(BigDecimal.ZERO, BigDecimal::add);

        List<String> recommendations = new ArrayList<>();
        recommendations.add(String.format("Total power consumption: %.2f W", totalPower));

        if (totalPower.compareTo(BigDecimal.valueOf(5000)) > 0) {
            recommendations.add("Consider installing a three-phase electrical system for high power consumption.");
        }

        recommendations.add("Ensure proper grounding and protection devices are installed.");
        recommendations.add("Use appropriate wire cross-sections based on current load.");

        return String.join("\n", recommendations);
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\StatisticsService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.response.ApplianceStatisticsResponse;
import com.verchuk.electro.model.Appliance;
import com.verchuk.electro.model.ProjectAppliance;
import com.verchuk.electro.repository.ApplianceRepository;
import com.verchuk.electro.repository.ProjectApplianceRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.math.BigDecimal;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

@Service
public class StatisticsService {
    @Autowired
    private ApplianceRepository applianceRepository;

    @Autowired
    private ProjectApplianceRepository projectApplianceRepository;

    public List<ApplianceStatisticsResponse> getApplianceStatistics() {
        List<Appliance> allAppliances = applianceRepository.findAll();

        return allAppliances.stream()
                .map(appliance -> {
                    List<ProjectAppliance> projectAppliances = projectApplianceRepository.findAll().stream()
                            .filter(pa -> pa.getAppliance().getId().equals(appliance.getId()))
                            .collect(Collectors.toList());

                    long usageCountSum = projectAppliances.stream()
                            .mapToLong(pa -> pa.getQuantity() != null ? pa.getQuantity().longValue() : 0L)
                            .sum();
                    Long usageCount = usageCountSum;

                    BigDecimal totalPowerConsumption = projectAppliances.stream()
                            .map(pa -> pa.getTotalPower() != null ? pa.getTotalPower() : BigDecimal.ZERO)
                            .reduce(BigDecimal.ZERO, BigDecimal::add);

                    Set<Long> projectIds = projectAppliances.stream()
                            .map(pa -> pa.getProject().getId())
                            .collect(Collectors.toSet());

                    return ApplianceStatisticsResponse.builder()
                            .applianceId(appliance.getId())
                            .applianceName(appliance.getName())
                            .usageCount(usageCount)
                            .totalPowerConsumption(totalPowerConsumption)
                            .projectsCount(projectIds.size())
                            .build();
                })
                .collect(Collectors.toList());
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\UserService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.UserUpdateRequest;
import com.verchuk.electro.dto.response.UserResponse;
import com.verchuk.electro.exception.BadRequestException;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.Role;
import com.verchuk.electro.model.User;
import com.verchuk.electro.repository.RoleRepository;
import com.verchuk.electro.repository.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;

    @Autowired
    private RoleRepository roleRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    public User getCurrentUser() {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        String username = authentication.getName();
        return userRepository.findByUsername(username)
                .orElseThrow(() -> new ResourceNotFoundException("User", "username", username));
    }

    public UserResponse getCurrentUserProfile() {
        return UserResponse.fromUser(getCurrentUser());
    }

    @Transactional
    public UserResponse updateCurrentUserProfile(UserUpdateRequest request) {
        User user = getCurrentUser();

        if (request.getEmail() != null && !request.getEmail().equals(user.getEmail())) {
            if (userRepository.existsByEmail(request.getEmail())) {
                throw new BadRequestException("Email is already in use!");
            }
            user.setEmail(request.getEmail());
        }

        if (request.getFirstName() != null) {
            user.setFirstName(request.getFirstName());
        }

        if (request.getLastName() != null) {
            user.setLastName(request.getLastName());
        }

        if (request.getPhotoUrl() != null) {
            user.setPhotoUrl(request.getPhotoUrl());
        }

        return UserResponse.fromUser(userRepository.save(user));
    }

    @Transactional
    public void deleteCurrentUser() {
        User user = getCurrentUser();
        userRepository.delete(user);
    }

    // Admin methods
    public List<UserResponse> getAllUsers() {
        return userRepository.findAll().stream()
                .map(UserResponse::fromUser)
                .collect(Collectors.toList());
    }

    public UserResponse getUserById(Long id) {
        User user = userRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("User", "id", id));
        return UserResponse.fromUser(user);
    }

    @Transactional
    public UserResponse createUser(com.verchuk.electro.dto.request.RegisterRequest request, List<String> roleNames) {
        if (userRepository.existsByUsername(request.getUsername())) {
            throw new BadRequestException("Username is already taken!");
        }
        if (userRepository.existsByEmail(request.getEmail())) {
            throw new BadRequestException("Email is already in use!");
        }

        User user = User.builder()
                .username(request.getUsername())
                .email(request.getEmail())
                .password(passwordEncoder.encode(request.getPassword()))
                .firstName(request.getFirstName())
                .lastName(request.getLastName())
                .enabled(true)
                .build();

        Set<Role> roles = new HashSet<>();
        for (String roleName : roleNames) {
            Role.RoleName roleNameEnum = Role.RoleName.valueOf(roleName.toUpperCase());
            Role role = roleRepository.findByName(roleNameEnum)
                    .orElseThrow(() -> new BadRequestException("Role not found: " + roleName));
            roles.add(role);
        }
        user.setRoles(roles);

        return UserResponse.fromUser(userRepository.save(user));
    }

    @Transactional
    public UserResponse updateUser(Long id, UserUpdateRequest request, List<String> roleNames) {
        User user = userRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("User", "id", id));

        if (request.getEmail() != null && !request.getEmail().equals(user.getEmail())) {
            if (userRepository.existsByEmail(request.getEmail())) {
                throw new BadRequestException("Email is already in use!");
            }
            user.setEmail(request.getEmail());
        }

        if (request.getFirstName() != null) {
            user.setFirstName(request.getFirstName());
        }

        if (request.getLastName() != null) {
            user.setLastName(request.getLastName());
        }

        if (request.getPhotoUrl() != null) {
            user.setPhotoUrl(request.getPhotoUrl());
        }

        if (roleNames != null && !roleNames.isEmpty()) {
            Set<Role> roles = new HashSet<>();
            for (String roleName : roleNames) {
                Role.RoleName roleNameEnum = Role.RoleName.valueOf(roleName.toUpperCase());
                Role role = roleRepository.findByName(roleNameEnum)
                        .orElseThrow(() -> new BadRequestException("Role not found: " + roleName));
                roles.add(role);
            }
            user.setRoles(roles);
        }

        return UserResponse.fromUser(userRepository.save(user));
    }

    @Transactional
    public void deleteUser(Long id) {
        User user = userRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("User", "id", id));
        userRepository.delete(user);
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\java\com\verchuk\electro\service\WallService.java] 
 
package com.verchuk.electro.service;

import com.verchuk.electro.dto.request.WallOpeningRequest;
import com.verchuk.electro.dto.request.WallRequest;
import com.verchuk.electro.dto.response.WallOpeningResponse;
import com.verchuk.electro.dto.response.WallResponse;
import com.verchuk.electro.exception.ResourceNotFoundException;
import com.verchuk.electro.model.FloorPlan;
import com.verchuk.electro.model.Wall;
import com.verchuk.electro.model.WallOpening;
import com.verchuk.electro.repository.FloorPlanRepository;
import com.verchuk.electro.repository.WallRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class WallService {
    @Autowired
    private WallRepository wallRepository;

    @Autowired
    private FloorPlanRepository floorPlanRepository;

    @Autowired
    private UserService userService;

    @Transactional
    public WallResponse createWall(Long projectId, WallRequest request) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);

        Wall wall = Wall.builder()
                .floorPlan(floorPlan)
                .startX(request.getStartX())
                .startY(request.getStartY())
                .endX(request.getEndX())
                .endY(request.getEndY())
                .thickness(request.getThickness() != null ? request.getThickness() : BigDecimal.valueOf(20))
                .wallType(request.getWallType())
                .build();

        if (request.getOpenings() != null && !request.getOpenings().isEmpty()) {
            final Wall wallFinal = wall; // Создаем final переменную для использования в лямбде
            List<WallOpening> openings = request.getOpenings().stream()
                    .map(openingRequest -> WallOpening.builder()
                            .wall(wallFinal)
                            .position(openingRequest.getPosition())
                            .width(openingRequest.getWidth())
                            .height(openingRequest.getHeight())
                            .openingType(openingRequest.getOpeningType())
                            .build())
                    .collect(Collectors.toList());
            wall.setOpenings(openings);
        }

        wall = wallRepository.save(wall);
        return mapToResponse(wall);
    }

    @Transactional
    public WallResponse updateWall(Long projectId, Long wallId, WallRequest request) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);
        Wall wall = wallRepository.findById(wallId)
                .orElseThrow(() -> new ResourceNotFoundException("Wall", "id", wallId));

        if (!wall.getFloorPlan().getId().equals(floorPlan.getId())) {
            throw new ResourceNotFoundException("Wall", "id", wallId);
        }

        wall.setStartX(request.getStartX());
        wall.setStartY(request.getStartY());
        wall.setEndX(request.getEndX());
        wall.setEndY(request.getEndY());
        if (request.getThickness() != null) {
            wall.setThickness(request.getThickness());
        }
        wall.setWallType(request.getWallType());

        // Обновление проемов
        if (request.getOpenings() != null) {
            wall.getOpenings().clear();
            final Wall wallFinal = wall; // Создаем final переменную для использования в лямбде
            request.getOpenings().forEach(openingRequest -> {
                WallOpening opening = WallOpening.builder()
                        .wall(wallFinal)
                        .position(openingRequest.getPosition())
                        .width(openingRequest.getWidth())
                        .height(openingRequest.getHeight())
                        .openingType(openingRequest.getOpeningType())
                        .build();
                wallFinal.getOpenings().add(opening);
            });
        }

        wall = wallRepository.save(wall);
        return mapToResponse(wall);
    }

    @Transactional
    public void deleteWall(Long projectId, Long wallId) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);
        Wall wall = wallRepository.findById(wallId)
                .orElseThrow(() -> new ResourceNotFoundException("Wall", "id", wallId));

        if (!wall.getFloorPlan().getId().equals(floorPlan.getId())) {
            throw new ResourceNotFoundException("Wall", "id", wallId);
        }

        wallRepository.delete(wall);
    }

    public List<WallResponse> getWallsByFloorPlan(Long floorPlanId) {
        List<Wall> walls = wallRepository.findByFloorPlanId(floorPlanId);
        return walls.stream()
                .map(this::mapToResponse)
                .collect(Collectors.toList());
    }

    @Transactional
    public List<WallResponse> saveWalls(Long projectId, List<WallRequest> requests) {
        FloorPlan floorPlan = getFloorPlanForProject(projectId);
        
        // Удаляем старые стены
        wallRepository.deleteByFloorPlanId(floorPlan.getId());

        // Создаем новые стены
        List<Wall> walls = requests.stream()
                .map(request -> {
                    Wall wall = Wall.builder()
                            .floorPlan(floorPlan)
                            .startX(request.getStartX())
                            .startY(request.getStartY())
                            .endX(request.getEndX())
                            .endY(request.getEndY())
                            .thickness(request.getThickness() != null ? request.getThickness() : BigDecimal.valueOf(20))
                            .wallType(request.getWallType())
                            .build();

                    if (request.getOpenings() != null && !request.getOpenings().isEmpty()) {
                        List<WallOpening> openings = request.getOpenings().stream()
                                .map(openingRequest -> WallOpening.builder()
                                        .wall(wall)
                                        .position(openingRequest.getPosition())
                                        .width(openingRequest.getWidth())
                                        .height(openingRequest.getHeight())
                                        .openingType(openingRequest.getOpeningType())
                                        .build())
                                .collect(Collectors.toList());
                        wall.setOpenings(openings);
                    }

                    return wall;
                })
                .collect(Collectors.toList());

        walls = wallRepository.saveAll(walls);
        return walls.stream()
                .map(this::mapToResponse)
                .collect(Collectors.toList());
    }

    public FloorPlan getFloorPlanForProject(Long projectId) {
        var designer = userService.getCurrentUser();
        return floorPlanRepository.findByProjectId(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("FloorPlan", "projectId", projectId));
    }

    private WallResponse mapToResponse(Wall wall) {
        List<WallOpeningResponse> openings = wall.getOpenings() != null
                ? wall.getOpenings().stream()
                        .map(this::mapOpeningToResponse)
                        .collect(Collectors.toList())
                : List.of();

        return WallResponse.builder()
                .id(wall.getId())
                .startX(wall.getStartX())
                .startY(wall.getStartY())
                .endX(wall.getEndX())
                .endY(wall.getEndY())
                .thickness(wall.getThickness())
                .wallType(wall.getWallType())
                .openings(openings)
                .build();
    }

    private WallOpeningResponse mapOpeningToResponse(WallOpening opening) {
        return WallOpeningResponse.builder()
                .id(opening.getId())
                .position(opening.getPosition())
                .width(opening.getWidth())
                .height(opening.getHeight())
                .openingType(opening.getOpeningType())
                .build();
    }
}

 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\main\resources\application.properties] 
 
spring.application.name=electro

spring.datasource.url=jdbc:postgresql://localhost:5432/electrodb
spring.datasource.username=postgres
spring.datasource.password=123
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Server Configuration
server.port=8080

# JWT Configuration
jwt.secret=mySecretKeyForJWTTokenGenerationAndValidationShouldBeAtLeast256Bits
jwt.expiration=86400000

# CORS Configuration
spring.web.cors.allowed-origins=*
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=* 
====== КОНЕЦ ФАЙЛА ====== 
 
[ФАЙЛ: D:\7semestr\Electricity\Project\electro\src\test\java\com\verchuk\electro\ElectroApplicationTests.java] 
 
package com.verchuk.electro;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class ElectroApplicationTests {

    @Test
    void contextLoads() {
    }

}
 
====== КОНЕЦ ФАЙЛА ====== 
